"use strict";(self.webpackChunkmortal_wombat=self.webpackChunkmortal_wombat||[]).push([[289],{63:function(t,e,n){n.d(e,{G9:function(){return m},Ib:function(){return p},Vx:function(){return y},mu:function(){return f},ni:function(){return v},oL:function(){return d}});var r=n(861),i=n(757),a=n.n(i),o=n(426),s=n(408),c=n(162);(0,o.ZF)({apiKey:"AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I",authDomain:"mortal-wombat-8c76a.firebaseapp.com",projectId:"mortal-wombat-8c76a",storageBucket:"mortal-wombat-8c76a.appspot.com",messagingSenderId:"929181149015",appId:"1:929181149015:web:33a7f450bcdbb06ae64012",measurementId:"G-JL6HCMYYBS"});var l=(0,s.N8)(),u=(0,c.v0)(),h=(0,s.iH)(l),y=function(t,e){try{return console.log("updates",t),(0,s.Vx)(h,t)}catch(n){console.error(n),e(n.message)}};window._update=function(){var t=(0,r.Z)(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=console,t.next=3,(0,s.Vx)(h,e);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.log.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var f=function(){var t=(0,r.Z)(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Object,t.next=3,Promise.all(e.map(function(){var t=(0,r.Z)(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,(0,s.U2)((0,s.iU)(h,e));case 3:return t.t1=t.sent.val(),t.abrupt("return",[t.t0,t.t1]);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:return t.t1=t.sent,t.abrupt("return",t.t0.fromEntries.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),d=function(t,e,n){try{var r=(0,s.iH)(l,t);return(0,s.jM)(r,(function(t){return e(t.val())})),function(){return(0,s.S1)(r)}}catch(i){console.error(i),n(i.message)}},p=function(t,e){return(0,c.e5)(u,t,e)},m=function(t){return(0,c.Aj)(u,t)},v=function(){return(0,c.w7)(u)}},289:function(t,e,n){n.r(e);var r=n(861),i=n(757),a=n.n(i),o=n(63),s=n(671),c=n(144),l=32,u=function(t,e,n,r,i,a){t.fillStyle="black",t.fillText(e,n+a,r+a),t.fillStyle=i,t.fillText(e,n,r)},h=function(t,e,n,r,i,a,o,s){t.fillStyle=r,t.fillRect(i,a,e/n*o,s),t.strokeStyle="white",t.strokeRect(i,a,o,s),t.fillStyle="white",t.font="18px sans-serif",t.textAlign="left",t.textBaseline="top",t.fillText(Math.floor(e),i+2,a+1)},y=function(){function t(e){var n=this;(0,s.Z)(this,t),this.canvas=e,this.ctx=e.getContext("2d",{antialias:!1,depth:!1}),this.resize(),window.addEventListener("resize",(function(){return n.resize()}))}return(0,c.Z)(t,[{key:"resize",value:function(){var t=this.canvas;this.width=t.width=innerWidth,this.height=t.height=innerHeight}},{key:"render",value:function(t){var e=t.you,n=t.health,r=t.maxHealth,i=t.poop,a=t.maxPoop,o=t.blocks,s=this.ctx,c=this.width,y=this.height;s.clearRect(0,0,c,y),s.save(),s.translate(c/2-e.x*l-16,y/2-e.y*l-16);for(var f=0,d=Object.values(o);f<d.length;f++){var p=d[f],m=p.x,v=p.y,x=p.type;s.fillStyle=x.color,s.fillRect(m*l,v*l,l,l)}s.fillStyle="red",s.fillRect(e.x*l,e.y*l,l,l);var g=Math.atan2(e.dirY,e.dirX);s.strokeStyle="black",s.lineWidth=2,s.beginPath(),s.moveTo((e.x+.5)*l,(e.y+.5)*l),s.lineTo((e.x+.5)*l+Math.cos(g)*l/2,(e.y+.5)*l+Math.sin(g)*l/2),s.stroke(),s.restore(),n>0?(h(s,n,r,n>30?"green":"red",10,10,500,20),h(s,i,a,"brown",10,40,500,20)):(s.textBaseline="middle",s.textAlign="center",s.font="120px sans-serif",u(s,"you dead",innerWidth/2,innerHeight/2,"red",5),s.font="32px sans-serif",u(s,"press R to try again",innerWidth/2,innerHeight/2+60,"#AFF",3))}}]),t}(),f=n(762),d=n(413),p=function(t,e,n,r){if(function(t,e,n,r){return n.type.collectible?(e.jewels++,!0):(n.type.healing<0&&(t.health=Math.max(0,t.health+Number(n.type.healing))),!!(n.type.edible&&r.Space&&(void 0===n.eaten&&(n.eaten=1),n.eaten-=t.eatSpeed,t.health=Math.min(t.maxHealth,t.health+n.type.healing*t.eatSpeed),t.poop=Math.min(t.maxPoop,t.poop+n.type.makePoop*t.eatSpeed),n.eaten<=0))||!!(n.type.diggable&&r.Space&&(void 0===n.dug&&(n.dug=1),n.dug-=t.digSpeed,n.dug<=0))||void 0)}(t,e,n,r))return!0;var i=e.x-n.x,a=e.y-n.y;Math.abs(i)>Math.abs(a)?(e.x=n.x+(e.x<n.x?-1:1),e.xs=0):(e.y<n.y&&(e.jumping=!1),e.y=n.y+(e.y<n.y?-1:1),e.ys=0)},m=function(){function t(e,n,r){for(var i in(0,s.Z)(this,t),this.blocks=n,this.frame=0,this.you=(0,d.Z)({x:0,y:0,xs:0,ys:0,dirX:1,dirY:0,jewels:0},e),this.digSpeed=.05,this.eatSpeed=.05,this.gravity=.005,this.health=100,this.maxHealth=100,this.poop=0,this.maxPoop=10,this.jumpPower=.11,this.magmaDelay=30,this.moveSpeed=.015,this.moveDeceleration=.3,r)isNaN(r[i])||(this[i]=Number(r[i]))}return(0,c.Z)(t,[{key:"iterate",value:function(t){this.iterateYou(t),this.frame%this.magmaDelay===0&&this.iterateMagma(),this.frame++}},{key:"iterateYou",value:function(t){var e=this.you,n=this.blocks,r=this.gravity;if(this.health<=0)t.KeyR&&location.reload();else{(t.KeyA||t.KeyD||t.KeyW||t.KeyS)&&(e.dirX=0,e.dirY=0),t.KeyA&&(e.xs-=this.moveSpeed,e.dirX--),t.KeyD&&(e.xs+=this.moveSpeed,e.dirX++),t.KeyW&&(e.jumping||e.ys||(e.ys-=this.jumpPower,e.jumping=!0),e.dirY--),t.KeyS&&e.dirY++,e.x+=e.xs,e.xs*=1-this.moveDeceleration,e.ys+=r,e.y+=e.ys;for(var i=0,a=["".concat(Math.floor(e.x),"_").concat(Math.floor(e.y)),"".concat(Math.ceil(e.x),"_").concat(Math.floor(e.y)),"".concat(Math.floor(e.x),"_").concat(Math.ceil(e.y)),"".concat(Math.ceil(e.x),"_").concat(Math.ceil(e.y))];i<a.length;i++){var o=a[i];if(n[o])p(this,e,n[o],t)&&delete n[o]}}}},{key:"isEmpty",value:function(t,e){return!this.blocks["".concat(t,"_").concat(e)]}},{key:"move",value:function(t,e,n,r){var i="".concat(t,"_").concat(e),a=this.blocks[i];delete this.blocks[i],a.x+=n,a.y+=r,this.blocks["".concat(a.x,"_").concat(a.y)]=a}},{key:"iterateMagma",value:function(){var t,e=Object.values(this.blocks).filter((function(t){return"liquid"===t.type.movement})).sort((function(t,e){return t.y===e.y?Math.random()-.5:t.y-e.y})),n=(0,f.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.isEmpty(r.x,r.y+1))this.move(r.x,r.y,0,1);else{var i=this.isEmpty(r.x-1,r.y),a=this.isEmpty(r.x+1,r.y);i&&a?this.move(r.x,r.y,Math.random()<.5?1:-1,0):i?this.move(r.x,r.y,-1,0):a&&this.move(r.x,r.y,1,0)}}}catch(o){n.e(o)}finally{n.f()}}}]),t}(),v=function(){var t=(0,r.Z)(a().mark((function t(){var e,n,r,i,s,c,l,u,h,f,d,p,v,x,g,b,w,k,S;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,o.mu)(["tileTypes","world","gameConfig"]);case 2:for(e=t.sent,n=e.tileTypes,r=e.world,i=e.gameConfig,s={},l=0,u=Object.values(n);l<u.length;l++)h=u[l],s[h.id]=h;for(f in r)d=r[f],p=d.x,v=d.y,"w"===(x=d.tileType)?(c={x:p,y:v},delete r[f]):r[f]={x:p,y:v,type:s[x]};if(location.hash.length>1)try{c=JSON.parse(atob(location.hash.slice(1)))}catch(a){console.log("bad hash",a)}console.log(i),g=new m(c,r,i),b=document.createElement("canvas"),w=new y(b),document.body.append(b),document.body.style.background="black",document.body.style.margin=0,document.body.style.overflow="hidden",k={},function t(){g.iterate(k),w.render(g),requestAnimationFrame(t)}(),S=function(t){return k[t.code]="keydown"===t.type},window.addEventListener("keydown",S),window.addEventListener("keyup",S);case 24:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();v()}}]);
//# sourceMappingURL=289.d0f536c4.chunk.js.map