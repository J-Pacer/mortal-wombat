"use strict";(self.webpackChunkmortal_wombat=self.webpackChunkmortal_wombat||[]).push([[91],{63:function(t,e,n){n.d(e,{G9:function(){return m},Ib:function(){return v},Vx:function(){return p},mu:function(){return y},ni:function(){return x},oL:function(){return f},rZ:function(){return d}});var i=n(861),r=n(757),a=n.n(r),o=n(426),s=n(408),u=n(918);(0,o.ZF)({apiKey:"AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I",authDomain:"mortal-wombat-8c76a.firebaseapp.com",projectId:"mortal-wombat-8c76a",storageBucket:"mortal-wombat-8c76a.appspot.com",messagingSenderId:"929181149015",appId:"1:929181149015:web:33a7f450bcdbb06ae64012",measurementId:"G-JL6HCMYYBS"});var l=(0,s.N8)(),c=(0,u.v0)(),h=(0,s.iH)(l),d="l31p2np9:dy828s8l3wv",p=function(t,e){try{return(0,s.Vx)(h,t)}catch(n){console.error(n),e(n.message)}};"localhost:3000"===location.host&&(window._update=function(){var t=(0,i.Z)(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.Vx)(h,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());var y=function(){var t=(0,i.Z)(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Object,t.next=3,Promise.all(e.map(function(){var t=(0,i.Z)(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,(0,s.U2)((0,s.iU)(h,e));case 3:return t.t1=t.sent.val(),t.abrupt("return",[t.t0,t.t1]);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:return t.t1=t.sent,t.abrupt("return",t.t0.fromEntries.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),f=function(t,e,n){try{var i=(0,s.iH)(l,t);return(0,s.jM)(i,(function(t){return e(t.val()||{})})),function(){return(0,s.S1)(i)}}catch(r){console.error(r),n(r.message)}},v=function(t,e){return(0,u.e5)(c,t,e)},m=function(t){return(0,u.Aj)(c,t)},x=function(){return(0,u.w7)(c)}},91:function(t,e,n){n.r(e);var i,r=n(861),a=n(757),o=n.n(a),s=n(63),u=n(457),l=n(762),c=n(413),h=n(671),d=n(144),p=n(136),y=n(668),f=n(546),v=n(147),m=function(){function t(){(0,h.Z)(this,t),this.el=document.createElement("div")}return(0,d.Z)(t,[{key:"destroy",value:function(){this.el.remove()}}]),t}(),x=function(t){(0,p.Z)(n,t);var e=(0,y.Z)(n);function n(t){var i;return(0,h.Z)(this,n),i=e.call(this),t.append(i.el),i}return(0,d.Z)(n,[{key:"update",value:function(t){var e=innerWidth/2-48*t.x,n=innerHeight/2-48*t.y;this.el.style.transform="translate(".concat(e,"px,").concat(n,"px)")}}]),n}(m),w=function(t){(0,p.Z)(n,t);var e=(0,y.Z)(n);function n(t,i){var r;return(0,h.Z)(this,n),(r=e.call(this)).el.classList.add("tile"),r.el.style.background=(0,f.V)(i.type),r.update(i),t.append(r.el),r}return(0,d.Z)(n,[{key:"update",value:function(t){var e=t.x,n=t.y,i=t.dirX,r=void 0===i?0:i,a=t.dirY,o=void 0===a?0:a,s=Math.atan2(o,r)+Math.PI,u=s>=.5*Math.PI&&s<=1.5*Math.PI;this.el.style.transform="\n    translate(".concat(48*e,"px,").concat(48*n,"px)\n    rotate(").concat(s,"rad)\n    ").concat(u?"scaleY(-1)":"")}}]),n}(m),g=function(t){(0,p.Z)(n,t);var e=(0,y.Z)(n);function n(t){var i;return(0,h.Z)(this,n),(i=e.call(this)).el.classList.add("bar"),i.valueElement=document.createElement("div"),i.el.append(i.valueElement),t.append(i.el),i}return(0,d.Z)(n,[{key:"update",value:function(t,e,n){var i=this.valueElement;i.style.background=n,i.style.width=100*t/e+"%",i.innerText=Math.floor(t)}}]),n}(m),M=function(t){(0,p.Z)(n,t);var e=(0,y.Z)(n);function n(t,i){var r;return(0,h.Z)(this,n),(r=e.call(this)).typeIndex=i,r.el.classList.add("jewelCounter"),t.append(r.el),r}return(0,d.Z)(n,[{key:"update",value:function(t){this.el.innerHTML="".concat(t,' <img src="').concat(this.typeIndex.j.image,'" />')}}]),n}(m),Z=function(t){(0,p.Z)(n,t);var e=(0,y.Z)(n);function n(t,i){var r;return(0,h.Z)(this,n),(r=e.call(this)).el.classList.add("hud"),r.healthBar=new g(r.el),r.poopBar=new g(r.el),r.jewelCounter=new M(r.el,i),t.append(r.el),r}return(0,d.Z)(n)}(m),k=function(t){(0,p.Z)(n,t);var e=(0,y.Z)(n);function n(t){var i;return(0,h.Z)(this,n),(i=e.call(this)).el.classList.add("version"),i.el.innerText="v"+v.i8,t.append(i.el),i}return(0,d.Z)(n)}(m),b=function(){function t(e,n,i,r,a){for(var o in(0,h.Z)(this,t),this.rootElement=a,this.worldElement=new x(a),this.hud=new Z(a,r),new k(a),this.world={},n)this.addTile(n[o]);this.typeIndex=r,this.you=(0,c.Z)({x:0,y:0,xs:0,ys:0,dirX:1,dirY:0},e),this.you.el=new w(this.worldElement.el,{x:this.you.x,y:this.you.y,type:r.w});for(var s=0,u=["x","y","dirX","dirY"];s<u.length;s++){var l=u[s];this.you["p"+l]=this.you[l]}for(var d in this.jewels=0,this.frame=0,this.digSpeed=.07,this.eatSpeed=.05,this.gravity=.005,this.health=100,this.maxHealth=100,this.poop=50,this.maxPoop=10,this.jumpPower=.11,this.moveSpeed=.02,this.moveDeceleration=.3,this.fallDamageMin=.2,this.fallDamageMult=100,i)isNaN(i[d])||(this[d]=Number(i[d]));this.setHealth(this.health),this.setPoop(this.poop),this.you.el.update(this.you),this.worldElement.update(this.you)}return(0,d.Z)(t,[{key:"iterate",value:function(t){return this.iterateYou(t),this.iterateTiles(),this.frame++,this}},{key:"addTile",value:function(t){this.world["".concat(t.x,"_").concat(t.y)]=(0,c.Z)((0,c.Z)({},t),{},{el:new w(this.worldElement.el,t)})}},{key:"deleteTile",value:function(t){t.el.destroy(),delete this.world["".concat(t.x,"_").concat(t.y)]}},{key:"iterateYou",value:function(t){var e=this.you,n=this.world,i=this.gravity;if(this.health<=0)t.KeyR&&location.reload();else{(t.KeyA||t.KeyD||t.KeyW||t.KeyS)&&(e.dirX=0,e.dirY=0),t.KeyA&&(e.xs-=this.moveSpeed,e.dirX--),t.KeyD&&(e.xs+=this.moveSpeed,e.dirX++),t.KeyW&&(e.jumping||e.ys||(e.ys-=this.jumpPower,e.jumping=!0),e.dirY--),t.KeyS&&e.dirY++,e.x+=e.xs,e.xs*=1-this.moveDeceleration,e.ys+=i,e.y+=e.ys;var r,a=(0,l.Z)((0,u.jj)(["".concat(Math.floor(e.x),"_").concat(Math.floor(e.y)),"".concat(Math.ceil(e.x),"_").concat(Math.floor(e.y)),"".concat(Math.floor(e.x),"_").concat(Math.ceil(e.y)),"".concat(Math.ceil(e.x),"_").concat(Math.ceil(e.y))]));try{for(a.s();!(r=a.n()).done;){var o=n[r.value];o&&this.interact(o,t)}}catch(s){a.e(s)}finally{a.f()}(Math.abs(e.x-e.px)>.1||Math.abs(e.y-e.py)>.1||e.dirX!==e.pdirX||e.dirY!==e.pdirY)&&(e.el.update(e),this.worldElement.update(e),e.px=e.x,e.py=e.y,e.pdirX=e.dirX,e.pdirY=e.dirY)}}},{key:"interact",value:function(t,e){var n=this.you;if(t.type.collectible)return this.incJewels(),this.deleteTile(t);if(t.type.healing<0&&this.setHealth(this.health+Number(t.type.healing)),e.Space){var i=Math.atan2(n.dirY,n.dirX),r=Math.round(n.x+Math.cos(i)),a=Math.round(n.y+Math.sin(i)),o=this.getTile(r,a);if(null!==o&&void 0!==o&&o.type.edible&&(void 0===o.hp&&(o.hp=o.type.hp),o.hp-=this.eatSpeed,this.setHealth(this.health+o.type.healing*this.eatSpeed),this.setPoop(this.poop+o.type.makePoop*this.eatSpeed),o.hp<=0))return this.deleteTile(o);if(null!==o&&void 0!==o&&o.type.diggable&&(void 0===o.hp&&(o.hp=o.type.hp),o.hp-=this.digSpeed,o.hp<=0))return this.deleteTile(o)}if(Math.abs(n.x-t.x)>Math.abs(n.y-t.y)){var s=t.x<n.x?-1:1;!n.jumping&&Math.abs(n.ys)<.1&&t.type.movable&&this.isEmpty(t.x+s,t.y)?this.moveTile(t.x,t.y,s,0):n.x=t.x+(n.x<t.x?-1:1),n.xs=0}else n.y<t.y&&(n.jumping=!1),n.y=t.y+(n.y<t.y?-1:1),n.ys>this.fallDamageMin&&this.setHealth(this.health-(n.ys-this.fallDamageMin)*this.fallDamageMult),n.ys=0}},{key:"getTile",value:function(t,e){return this.world["".concat(t,"_").concat(e)]}},{key:"isEmpty",value:function(t,e){return!this.getTile(t,e)}},{key:"moveTile",value:function(t,e,n,i){var r="".concat(t,"_").concat(e),a=this.world[r];delete this.world[r],a.x+=n,a.y+=i,this.world["".concat(a.x,"_").concat(a.y)]=a,a.el.update(a)}},{key:"iterateTiles",value:function(){for(var t in this.world){var e=this.world[t];if(!(!e.type.moveDelay||this.frame%e.type.moveDelay>0||Math.pow(this.you.x-e.x,2)+Math.pow(this.you.y-e.y,2)>Math.pow(32,2)))if(this.isEmpty(e.x,e.y+1))this.moveTile(e.x,e.y,0,1);else if("liquid"===e.type.moveStyle){var n=this.isEmpty(e.x-1,e.y),i=this.isEmpty(e.x+1,e.y);n&&i?this.moveTile(e.x,e.y,Math.random()<.5?1:-1,0):n?this.moveTile(e.x,e.y,-1,0):i&&this.moveTile(e.x,e.y,1,0)}else"patrol"===e.type.moveStyle&&(e.dirX||(e.dirX=1),this.isEmpty(e.x+e.dirX,e.y)&&this.getTile(e.x+e.dirX,e.y+1)&&!this.getTile(e.x+e.dirX,e.y+1).type.moveDelay?this.moveTile(e.x,e.y,e.dirX,0):e.dirX*=-1)}}},{key:"setHealth",value:function(t){this.health=Math.max(0,Math.min(this.maxHealth,t)),this.hud.healthBar.update(this.health,this.maxHealth,this.health>30?"green":"red"),t<=0&&(this.rootElement.innerHTML+='<div class="youDead"><h1>you dead</h1><h2>press R to try again</h2></div>')}},{key:"setPoop",value:function(t){this.poop=Math.max(0,Math.min(this.maxPoop,t)),this.hud.poopBar.update(this.poop,this.maxPoop,"saddleBrown")}},{key:"incJewels",value:function(){this.jewels++,this.hud.jewelCounter.update(this.jewels)}},{key:"makePoop",value:function(){if(!(this.poop<1)){var t=this.you,e=this.world,n=this.typeIndex,i=Math.atan2(t.dirY,t.dirX)+Math.PI,r=Math.round(t.x+Math.cos(i)),a=Math.round(t.y+Math.sin(i));r===t.x&&a===t.y||e["".concat(r,"_").concat(a)]||(this.addTile({x:r,y:a,type:n.p}),this.setPoop(this.poop-1))}}}]),t}(),T=function(){var t=(0,r.Z)(o().mark((function t(){var e,n,i,r,a,l,c,h,d,p,y,f,v,m,x,w,g,M,Z;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(location.hash.length>1)try{r=JSON.parse(atob(location.hash.slice(1)))}catch(o){console.log("bad hash",o)}return a="worlds/".concat((0,u.kQ)(null===(e=r)||void 0===e?void 0:e.worldId)?r.worldId:s.rZ,"/world"),t.next=4,(0,s.mu)(["tileTypes",a,"gameConfig"]);case 4:for(l=t.sent,c=l.tileTypes,h=l.gameConfig,d=l[a],p={},f=0,v=Object.values(c);f<v.length;f++)m=v[f],p[m.id]=m;for(x in d)w=d[x],g=w.x,M=w.y,"w"===(Z=w.tileType)?(y={x:g,y:M},delete d[x]):p[Z]?d[x]={x:g,y:M,type:p[Z]}:delete d[x];return null!==(n=r)&&void 0!==n&&n.x&&null!==(i=r)&&void 0!==i&&i.y&&(y.x=r.x,y.y=r.y),t.abrupt("return",new b(y,d,h,p,document.querySelector("#root")));case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),S={},j=function t(){document.hasFocus()&&i?(document.body.style.opacity=1,i.iterate(S)):document.body.style.opacity=.5,requestAnimationFrame(t)},E=function(){var t=(0,r.Z)(o().mark((function t(){var e,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T();case 2:i=t.sent,j(),e=function(t){return S[t.code]="keydown"===t.type},n=function(t){"KeyP"===t.code&&i.makePoop()},window.addEventListener("keydown",e),window.addEventListener("keyup",e),window.addEventListener("keypress",n);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();E()},457:function(t,e,n){n.d(e,{Ds:function(){return d},HK:function(){return c},M8:function(){return u},P2:function(){return p},aW:function(){return h},an:function(){return s},jj:function(){return y},kQ:function(){return l}});var i=n(982),r=n(885),a=n(762),o=n(413),s=function(t,e){var n=(0,o.Z)({},e);return delete n[t],n},u=function(){return Date.now().toString(36)+":"+Math.random().toString(36).slice(2)},l=function(t){return/^[0-9a-z]{8,}:[0-9a-z]+$/.test(t)},c=function(t,e){var n,i={},r=(0,a.Z)(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;i[t(o)]=o}}catch(s){r.e(s)}finally{r.f()}return i},h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.entries(t).map((function(t){var e=(0,r.Z)(t,2),n=e[0],i=e[1];return(0,o.Z)({key:n},i)}))},d=function(t,e){var n,i=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];clearTimeout(n),n=setTimeout((function(){return t.apply(void 0,r)}),e)};return i.cancel=function(){return clearTimeout(n)},i},p=function(t,e){var n,r,a=!1,o=function o(){for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];a?r=u:(a=!0,n=setTimeout((function(){t.apply(void 0,u),a=!1,r&&o.apply(void 0,(0,i.Z)(r)),r=void 0}),e))};return o.cancel=function(){return clearTimeout(n)},o},y=function(t){var e={};return t.filter((function(t){return!e[t]&&(e[t]=!0)}))}},546:function(t,e,n){n.d(e,{V:function(){return i}});var i=function(t){return null!==t&&void 0!==t&&t.image?"no-repeat center/contain url(".concat(t.image,")"):null===t||void 0===t?void 0:t.color}},147:function(t){t.exports={i8:"0.1.5"}}}]);
//# sourceMappingURL=91.99c20252.chunk.js.map