"use strict";(self.webpackChunkmortal_wombat=self.webpackChunkmortal_wombat||[]).push([[91],{63:function(t,e,n){n.d(e,{G9:function(){return m},Ib:function(){return f},Vx:function(){return d},mu:function(){return p},ni:function(){return v},oL:function(){return y}});var i=n(861),a=n(757),o=n.n(a),r=n(426),s=n(408),h=n(162);(0,r.ZF)({apiKey:"AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I",authDomain:"mortal-wombat-8c76a.firebaseapp.com",projectId:"mortal-wombat-8c76a",storageBucket:"mortal-wombat-8c76a.appspot.com",messagingSenderId:"929181149015",appId:"1:929181149015:web:33a7f450bcdbb06ae64012",measurementId:"G-JL6HCMYYBS"});var u=(0,s.N8)(),c=(0,h.v0)(),l=(0,s.iH)(u),d=function(t,e){try{return console.log("updates",t),(0,s.Vx)(l,t)}catch(n){console.error(n),e(n.message)}};window._update=function(){var t=(0,i.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=console,t.next=3,(0,s.Vx)(l,e);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.log.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var p=function(){var t=(0,i.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Object,t.next=3,Promise.all(e.map(function(){var t=(0,i.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,(0,s.U2)((0,s.iU)(l,e));case 3:return t.t1=t.sent.val(),t.abrupt("return",[t.t0,t.t1]);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:return t.t1=t.sent,t.abrupt("return",t.t0.fromEntries.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),y=function(t,e,n){try{var i=(0,s.iH)(u,t);return(0,s.jM)(i,(function(t){return e(t.val())})),function(){return(0,s.S1)(i)}}catch(a){console.error(a),n(a.message)}},f=function(t,e){return(0,h.e5)(c,t,e)},m=function(t){return(0,h.Aj)(c,t)},v=function(){return(0,h.w7)(c)}},91:function(t,e,n){n.r(e);var i,a=n(861),o=n(757),r=n.n(o),s=n(63),h=n(413),u=n(671),c=n(144),l=n(546),d=48,p=function(){function t(e){(0,u.Z)(this,t),this.el=document.createElement("div"),e.append(this.el)}return(0,c.Z)(t,[{key:"update",value:function(t){var e=innerWidth/2-t.x*d,n=innerHeight/2-t.y*d;this.el.style.transform="translate(".concat(e,"px,").concat(n,"px)")}},{key:"destroy",value:function(){this.el.remove()}}]),t}(),y=function(){function t(e,n){(0,u.Z)(this,t),this.el=document.createElement("div"),this.el.classList.add("tile"),this.updatePosition(n),this.updateType(n),e.append(this.el)}return(0,c.Z)(t,[{key:"updatePosition",value:function(t){var e=t.x,n=t.y;this.el.style.transform="translate(".concat(e*d,"px, ").concat(n*d,"px)")}},{key:"updateType",value:function(t){var e=t.type;this.el.style.background=(0,l.V)(e)}},{key:"destroy",value:function(){this.el.remove()}}]),t}(),f=function(){function t(e,n){(0,u.Z)(this,t),this.el=document.createElement("div"),this.el.style.background=(0,l.V)(n.w),this.el.classList.add("tile"),e.append(this.el)}return(0,c.Z)(t,[{key:"update",value:function(t){var e=Math.atan2(t.dirY,t.dirX)+Math.PI,n=e>=.5*Math.PI&&e<=1.5*Math.PI;this.el.style.transform="\n    translate(".concat(t.x*d,"px,").concat(t.y*d,"px)\n    rotate(").concat(e,"rad)\n    ").concat(n?"scaleY(-1)":"")}},{key:"destroy",value:function(){this.el.remove()}}]),t}(),m=function(){function t(e){(0,u.Z)(this,t),this.el=document.createElement("div"),this.el.classList.add("bar"),this.valueElement=document.createElement("div"),this.el.append(this.valueElement),e.append(this.el)}return(0,c.Z)(t,[{key:"update",value:function(t,e,n){var i=this.valueElement;i.style.background=n,i.style.width=100*t/e+"%",i.innerText=Math.floor(t)}},{key:"destroy",value:function(){this.el.remove()}}]),t}(),v=function(){function t(e,n){(0,u.Z)(this,t),this.typeIndex=n,this.el=document.createElement("div"),this.el.classList.add("jewelCounter"),e.append(this.el)}return(0,c.Z)(t,[{key:"update",value:function(t){this.el.innerHTML="".concat(t,' <img src="').concat(this.typeIndex.j.image,'" />')}},{key:"destroy",value:function(){this.el.remove()}}]),t}(),x=(0,c.Z)((function t(e,n){(0,u.Z)(this,t),this.el=document.createElement("div"),this.el.classList.add("hud"),this.healthBar=new m(this.el),this.poopBar=new m(this.el),this.jewelCounter=new v(this.el,n),e.append(this.el)})),w=function(){function t(e,n,i,a,o){for(var r in(0,u.Z)(this,t),this.rootElement=o,this.worldElement=new p(o),this.hud=new x(o,a),this.world={},n)this.addTile(n[r]);this.typeIndex=a,this.you=(0,h.Z)((0,h.Z)({x:0,y:0,xs:0,ys:0,dirX:1,dirY:0},e),{},{el:new f(this.worldElement.el,a)});for(var s=0,c=["x","y","dirX","dirY"];s<c.length;s++){var l=c[s];this.you["p"+l]=this.you[l]}for(var d in this.jewels=0,this.frame=0,this.digSpeed=.07,this.eatSpeed=.05,this.gravity=.005,this.health=100,this.maxHealth=100,this.poop=50,this.maxPoop=10,this.jumpPower=.11,this.moveSpeed=.02,this.moveDeceleration=.3,i)isNaN(i[d])||(this[d]=Number(i[d]));this.setHealth(this.health),this.setPoop(this.poop)}return(0,c.Z)(t,[{key:"iterate",value:function(t){return this.iterateYou(t),this.iterateTiles(),this.frame++,this}},{key:"addTile",value:function(t){this.world["".concat(t.x,"_").concat(t.y)]=(0,h.Z)((0,h.Z)({},t),{},{el:new y(this.worldElement.el,t)})}},{key:"deleteTile",value:function(t){t.el.destroy(),delete this.world["".concat(t.x,"_").concat(t.y)]}},{key:"iterateYou",value:function(t){var e=this.you,n=this.world,i=this.gravity;if(this.health<=0)t.KeyR&&location.reload();else{(t.KeyA||t.KeyD||t.KeyW||t.KeyS)&&(e.dirX=0,e.dirY=0),t.KeyA&&(e.xs-=this.moveSpeed,e.dirX--),t.KeyD&&(e.xs+=this.moveSpeed,e.dirX++),t.KeyW&&(e.jumping||e.ys||(e.ys-=this.jumpPower,e.jumping=!0),e.dirY--),t.KeyS&&e.dirY++,e.x+=e.xs,e.xs*=1-this.moveDeceleration,e.ys+=i,e.y+=e.ys;for(var a=0,o=["".concat(Math.floor(e.x),"_").concat(Math.floor(e.y)),"".concat(Math.ceil(e.x),"_").concat(Math.floor(e.y)),"".concat(Math.floor(e.x),"_").concat(Math.ceil(e.y)),"".concat(Math.ceil(e.x),"_").concat(Math.ceil(e.y))];a<o.length;a++){var r=o[a];if(n[r])this.interact(e,n[r],t)&&this.deleteTile(n[r])}(Math.abs(e.x-e.px)>.1||Math.abs(e.y-e.py)>.1||e.dirX!==e.pdirX||e.dirY!==e.pdirY)&&(e.el.update(e),this.worldElement.update(e),e.px=e.x,e.py=e.y,e.pdirX=e.dirX,e.pdirY=e.dirY)}}},{key:"isEmpty",value:function(t,e){return!this.world["".concat(t,"_").concat(e)]&&(t!==this.you.x||e!==this.you.y)}},{key:"moveTile",value:function(t,e,n,i){var a="".concat(t,"_").concat(e),o=this.world[a];delete this.world[a],o.x+=n,o.y+=i,this.world["".concat(o.x,"_").concat(o.y)]=o,o.el.updatePosition(o)}},{key:"iterateTiles",value:function(){for(var t in this.world){var e=this.world[t];if(!(!e.type.moveDelay||this.frame%e.type.moveDelay>0||Math.pow(this.you.x-e.x,2)+Math.pow(this.you.y-e.y,2)>Math.pow(32,2)))if(this.isEmpty(e.x,e.y+1))this.moveTile(e.x,e.y,0,1);else if(e.type.liquid){var n=this.isEmpty(e.x-1,e.y),i=this.isEmpty(e.x+1,e.y);n&&i?this.moveTile(e.x,e.y,Math.random()<.5?1:-1,0):n?this.moveTile(e.x,e.y,-1,0):i&&this.moveTile(e.x,e.y,1,0)}}}},{key:"interact",value:function(t,e,n){if(this.onIntersect(e,n))return!0;if(Math.abs(t.x-e.x)>Math.abs(t.y-e.y)){var i=e.x<t.x?-1:1;!t.jumping&&Math.abs(t.ys)<.1&&e.type.movable&&this.isEmpty(e.x+i,e.y)?this.moveTile(e.x,e.y,i,0):t.x=e.x+(t.x<e.x?-1:1),t.xs=0}else t.y<e.y&&(t.jumping=!1),t.y=e.y+(t.y<e.y?-1:1),t.ys=0}},{key:"setHealth",value:function(t){this.health=Math.max(0,Math.min(this.maxHealth,t)),this.hud.healthBar.update(this.health,this.maxHealth,this.health>30?"green":"red"),t<=0&&(this.rootElement.innerHTML+='<div class="youDead"><h1>you dead</h1><h2>press R to try again</h2></div>')}},{key:"setPoop",value:function(t){this.poop=Math.max(0,Math.min(this.maxPoop,t)),this.hud.poopBar.update(this.poop,this.maxPoop,"saddleBrown")}},{key:"incJewels",value:function(){this.jewels++,this.hud.jewelCounter.update(this.jewels)}},{key:"onIntersect",value:function(t,e){return t.type.collectible?(this.incJewels(),!0):(t.type.healing<0&&this.setHealth(this.health+Number(t.type.healing)),!!(t.type.edible&&e.Space&&(void 0===t.eaten&&(t.eaten=1),t.eaten-=this.eatSpeed,this.setHealth(this.health+t.type.healing*this.eatSpeed),this.setPoop(this.poop+t.type.makePoop*this.eatSpeed),t.eaten<=0))||(!!(t.type.diggable&&e.Space&&(void 0===t.dug&&(t.dug=1),t.dug-=this.digSpeed,t.dug<=0))||void 0))}},{key:"makePoop",value:function(){if(!(this.poop<1)){var t=this.you,e=this.world,n=this.typeIndex,i=Math.atan2(t.dirY,t.dirX)+Math.PI,a=Math.round(t.x+Math.cos(i)),o=Math.round(t.y+Math.sin(i));a===t.x&&o===t.y||e["".concat(a,"_").concat(o)]||(this.addTile({x:a,y:o,type:n.p}),this.setPoop(this.poop-1))}}}]),t}(),k=function(){var t=(0,a.Z)(r().mark((function t(){var e,n,i,a,o,h,u,c,l,d,p,y,f,m;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.mu)(["tileTypes","world","gameConfig"]);case 2:for(e=t.sent,n=e.tileTypes,i=e.world,a=e.gameConfig,o={},u=0,c=Object.values(n);u<c.length;u++)l=c[u],o[l.id]=l;for(d in i)p=i[d],y=p.x,f=p.y,"w"===(m=p.tileType)?(h={x:y,y:f},delete i[d]):o[m]?i[d]={x:y,y:f,type:o[m]}:delete i[d];if(location.hash.length>1)try{h=JSON.parse(atob(location.hash.slice(1)))}catch(r){console.log("bad hash",r)}return t.abrupt("return",new w(h,i,a,o,document.querySelector("#root")));case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),g={},M=function t(){i&&i.iterate(g),requestAnimationFrame(t)},b=function(){var t=(0,a.Z)(r().mark((function t(){var e,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k();case 2:i=t.sent,M(),e=function(t){return g[t.code]="keydown"===t.type},n=function(t){"KeyP"===t.code&&i.makePoop()},window.addEventListener("keydown",e),window.addEventListener("keyup",e),window.addEventListener("keypress",n);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();b()},546:function(t,e,n){n.d(e,{V:function(){return i}});var i=function(t){return null!==t&&void 0!==t&&t.image?"no-repeat center/contain url(".concat(t.image,")"):null===t||void 0===t?void 0:t.color}}}]);
//# sourceMappingURL=91.8647c81c.chunk.js.map