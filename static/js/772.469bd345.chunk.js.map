{"version":3,"file":"static/js/772.469bd345.chunk.js","mappings":"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","sources":["firebase.js","game/Game.js","game/load.js","game/Render.js","game/main.js","utils/getBackground.js"],"sourcesContent":["import {initializeApp} from 'firebase/app';\nimport {\n  ref,\n  getDatabase,\n  update as _update,\n  onValue,\n  off,\n  get,\n  child,\n} from 'firebase/database';\nimport {\n  getAuth,\n  signInWithEmailAndPassword,\n  onAuthStateChanged,\n  signOut,\n} from 'firebase/auth';\n\ninitializeApp({\n  apiKey: 'AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I',\n  authDomain: 'mortal-wombat-8c76a.firebaseapp.com',\n  projectId: 'mortal-wombat-8c76a',\n  storageBucket: 'mortal-wombat-8c76a.appspot.com',\n  messagingSenderId: '929181149015',\n  appId: '1:929181149015:web:33a7f450bcdbb06ae64012',\n  measurementId: 'G-JL6HCMYYBS',\n});\n\n/*\nData:\nhttps://console.firebase.google.com/project/mortal-wombat-8c76a/database/mortal-wombat-8c76a-default-rtdb/data\nData Docs: https://firebase.google.com/docs/database/web/read-and-write?hl=en&authuser=0\nList Docs: https://firebase.google.com/docs/database/web/lists-of-data?hl=en&authuser=0\n\nUsers:\nhttps://console.firebase.google.com/project/mortal-wombat-8c76a/authentication/users\nUser Docs: https://firebase.google.com/docs/auth/web/manage-users\n*/\n\nconst db = getDatabase();\nconst auth = getAuth();\nconst dbRef = ref(db);\n\n// {path1: val1, path2: val2}\nexport const update = (updates, onError) => {\n  try {\n    console.log('updates', updates);\n    return _update(dbRef, updates);\n  } catch (e) {\n    console.error(e);\n    onError(e.message);\n  }\n};\n\nwindow._update = async (x) => console.log(await _update(dbRef, x));\n\nexport const loadData = async (things) =>\n  Object.fromEntries(\n    await Promise.all(\n      things.map(async (t) => [t, (await get(child(dbRef, t))).val()])\n    )\n  );\n\nexport const listen = (pathStr, onChange, onError) => {\n  try {\n    const r = ref(db, pathStr);\n    onValue(r, (snapshot) => onChange(snapshot.val()));\n    return () => off(r);\n  } catch (e) {\n    console.error(e);\n    onError(e.message);\n  }\n};\n\n// export const createUser = async (email, pwd) => {\n//   try {\n//     const result = await createUserWithEmailAndPassword(auth, email, pwd);\n//     return result.user;\n//   } catch (e) {\n//     console.error(e);\n//     return e.message;\n//   }\n// };\n\nexport const logIn = (email, pwd) =>\n  signInWithEmailAndPassword(auth, email, pwd);\n\nexport const listenUser = (onChange) => onAuthStateChanged(auth, onChange);\n\nexport const logOut = () => signOut(auth);\n","export class Game {\n  constructor(youPos, world, config, typeIndex) {\n    this.world = world;\n    this.typeIndex = typeIndex;\n    this.you = {\n      x: 0,\n      y: 0,\n      xs: 0,\n      ys: 0,\n      dirX: 1,\n      dirY: 0,\n      ...youPos,\n    };\n    this.jewels = 0;\n    this.frame = 0;\n\n    // these can all be overridden by config\n    this.digSpeed = 0.07;\n    this.eatSpeed = 0.05;\n    this.gravity = 0.005;\n    this.health = 100;\n    this.maxHealth = 100;\n    this.poop = 50;\n    this.maxPoop = 10;\n    this.jumpPower = 0.11;\n    this.moveSpeed = 0.02;\n    this.moveDeceleration = 0.3;\n\n    for (const x in config) {\n      if (!isNaN(config[x])) this[x] = Number(config[x]); // because editing them turns them into strings, yayyyy\n    }\n  }\n  iterate(pressing) {\n    this.iterateYou(pressing);\n    this.iterateTiles();\n    this.frame++;\n    return this;\n  }\n  iterateYou(pressing) {\n    const {you, world, gravity} = this;\n\n    if (this.health <= 0) {\n      if (pressing.KeyR) location.reload();\n      return;\n    }\n\n    if (pressing.KeyA || pressing.KeyD || pressing.KeyW || pressing.KeyS) {\n      you.dirX = 0;\n      you.dirY = 0;\n    }\n    if (pressing.KeyA) {\n      you.xs -= this.moveSpeed;\n      you.dirX--;\n    }\n    if (pressing.KeyD) {\n      you.xs += this.moveSpeed;\n      you.dirX++;\n    }\n    if (pressing.KeyW) {\n      if (!you.jumping && !you.ys) {\n        you.ys -= this.jumpPower;\n        you.jumping = true;\n      }\n      you.dirY--;\n    }\n    if (pressing.KeyS) {\n      you.dirY++;\n    }\n\n    you.x += you.xs;\n    you.xs *= 1 - this.moveDeceleration;\n    you.ys += gravity;\n    you.y += you.ys;\n\n    for (const key of [\n      `${Math.floor(you.x)}_${Math.floor(you.y)}`,\n      `${Math.ceil(you.x)}_${Math.floor(you.y)}`,\n      `${Math.floor(you.x)}_${Math.ceil(you.y)}`,\n      `${Math.ceil(you.x)}_${Math.ceil(you.y)}`,\n    ]) {\n      if (world[key]) {\n        const shouldDelete = this.interact(you, world[key], pressing);\n        if (shouldDelete) delete world[key];\n      }\n    }\n  }\n  isEmpty(x, y) {\n    return !this.world[`${x}_${y}`] && (x !== this.you.x || y !== this.you.y);\n  }\n  moveTile(x, y, dx, dy) {\n    const key = `${x}_${y}`;\n    const b = this.world[key];\n    delete this.world[key];\n    b.x += dx;\n    b.y += dy;\n    this.world[`${b.x}_${b.y}`] = b;\n  }\n  iterateTiles() {\n    for (const key in this.world) {\n      const b = this.world[key];\n      if (!b.type.moveDelay || this.frame % b.type.moveDelay > 0) continue;\n\n      if (this.isEmpty(b.x, b.y + 1)) {\n        this.moveTile(b.x, b.y, 0, 1);\n      } else if (b.type.liquid) {\n        const left = this.isEmpty(b.x - 1, b.y);\n        const right = this.isEmpty(b.x + 1, b.y);\n        if (left && right) {\n          this.moveTile(b.x, b.y, Math.random() < 0.5 ? 1 : -1, 0);\n        } else if (left) {\n          this.moveTile(b.x, b.y, -1, 0);\n        } else if (right) {\n          this.moveTile(b.x, b.y, 1, 0);\n        }\n      }\n    }\n  }\n  // if returns true, then delete block\n  interact(you, block, pressing) {\n    if (this.onIntersect(block, pressing)) return true;\n    if (Math.abs(you.x - block.x) > Math.abs(you.y - block.y)) {\n      const dx = block.x < you.x ? -1 : 1;\n      if (\n        !you.jumping &&\n        !you.ys &&\n        block.type.movable &&\n        this.isEmpty(block.x + dx, block.y)\n      ) {\n        this.moveTile(block.x, block.y, dx, 0);\n      } else {\n        you.x = block.x + (you.x < block.x ? -1 : 1);\n      }\n      you.xs = 0;\n    } else {\n      if (you.y < block.y) you.jumping = false;\n      you.y = block.y + (you.y < block.y ? -1 : 1);\n      you.ys = 0;\n    }\n  }\n  onIntersect(block, pressing) {\n    if (block.type.collectible) {\n      this.jewels++;\n      return true;\n    }\n\n    if (block.type.healing < 0) {\n      this.health = Math.max(0, this.health + Number(block.type.healing));\n    }\n\n    if (block.type.edible && pressing.Space) {\n      if (block.eaten === undefined) block.eaten = 1;\n      block.eaten -= this.eatSpeed;\n      this.health = Math.min(\n        this.maxHealth,\n        this.health + block.type.healing * this.eatSpeed\n      );\n      this.poop = Math.min(\n        this.maxPoop,\n        this.poop + block.type.makePoop * this.eatSpeed\n      );\n      if (block.eaten <= 0) return true;\n    }\n\n    if (block.type.diggable && pressing.Space) {\n      if (block.dug === undefined) block.dug = 1;\n      block.dug -= this.digSpeed;\n      if (block.dug <= 0) return true;\n    }\n  }\n  makePoop() {\n    if (this.poop < 1) return;\n    const {you, world, typeIndex} = this;\n    const angle = Math.atan2(you.dirY, you.dirX) + Math.PI;\n    const x = Math.round(you.x + Math.cos(angle));\n    const y = Math.round(you.y + Math.sin(angle));\n    if ((x !== you.x || y !== you.y) && !world[`${x}_${y}`]) {\n      world[`${x}_${y}`] = {x, y, type: typeIndex.p};\n      this.poop--;\n    }\n  }\n}\n","import {loadData} from '../firebase';\nimport {Game} from './Game';\n\nexport const load = async () => {\n  const {tileTypes, world, gameConfig} = await loadData([\n    'tileTypes',\n    'world',\n    'gameConfig',\n  ]);\n\n  const typeIndex = {};\n  let you;\n  for (const type of Object.values(tileTypes)) {\n    typeIndex[type.id] = type;\n  }\n  for (const key in world) {\n    const {x, y, tileType} = world[key];\n    if (tileType === 'w') {\n      you = {x, y};\n      delete world[key];\n    } else if (typeIndex[tileType]) {\n      world[key] = {x, y, type: typeIndex[tileType]};\n    } else {\n      delete world[key];\n    }\n  }\n\n  if (location.hash.length > 1) {\n    try {\n      you = JSON.parse(atob(location.hash.slice(1)));\n    } catch (e) {\n      console.log('bad hash', e);\n    }\n  }\n\n  return new Game(you, world, gameConfig, typeIndex);\n};\n","import {getBackground} from '../utils/getBackground';\n\nconst scale = 48;\n\nconst Viewport = ({you, children}) => {\n  const cx = innerWidth / 2 - you.x * scale;\n  const cy = innerHeight / 2 - you.y * scale;\n  return (\n    <div style={{transform: `translate(${cx}px,${cy}px)`}}>{children}</div>\n  );\n};\n\nconst Blocks = ({world}) =>\n  Object.entries(world).map(([key, {x, y, type}]) => (\n    <div\n      key={key}\n      className=\"tile\"\n      style={{\n        transform: `translate(${x * scale}px, ${y * scale}px)`,\n        background: getBackground(type),\n      }}\n    />\n  ));\n\nconst You = ({you, typeIndex}) => {\n  const wombatAngle = Math.atan2(you.dirY, you.dirX) + Math.PI;\n  const wombatFlip =\n    wombatAngle >= 0.5 * Math.PI && wombatAngle <= 1.5 * Math.PI;\n  return (\n    <div\n      className=\"tile\"\n      style={{\n        transform: `\n      translate(${you.x * scale}px,${you.y * scale}px)\n      rotate(${wombatAngle}rad)\n      ${wombatFlip ? 'scaleY(-1)' : ''}`,\n        background: getBackground(typeIndex.w),\n      }}\n    />\n  );\n};\n\nconst Bar = ({value, maxValue, color}) => (\n  <div className=\"bar\">\n    <div style={{background: color, width: (100 * value) / maxValue + '%'}}>\n      {Math.floor(value)}\n    </div>\n  </div>\n);\n\nconst Hud = ({health, maxHealth, poop, maxPoop, jewels, typeIndex}) =>\n  health > 0 ? (\n    <div className=\"hud\">\n      <Bar\n        value={health}\n        maxValue={maxHealth}\n        color={health > 30 ? 'green' : 'red'}\n      />\n      <Bar value={poop} maxValue={maxPoop} color=\"saddleBrown\" />\n      <div className=\"jewelCounter\">\n        {jewels} <img src={typeIndex.j.image} />\n      </div>\n    </div>\n  ) : (\n    <div className=\"youDead\">\n      <h1>you dead</h1>\n      <h2>press R to try again</h2>\n    </div>\n  );\n\nexport const Render = ({\n  you,\n  world,\n  health,\n  maxHealth,\n  poop,\n  maxPoop,\n  jewels,\n  typeIndex,\n}) => (\n  <>\n    <Viewport you={you}>\n      <Blocks world={world} />\n      <You you={you} typeIndex={typeIndex} />\n    </Viewport>\n\n    <Hud {...{health, maxHealth, poop, maxPoop, jewels, typeIndex}} />\n  </>\n);\n","import {StrictMode, useEffect, useRef, useState} from 'react';\nimport {createRoot} from 'react-dom/client';\nimport './game.css';\nimport {load} from './load';\nimport {Render} from './Render';\n\nconst useGame = () => {\n  const game = useRef();\n  const [, setCounter] = useState(0); // this is to force rerendering\n\n  useEffect(() => {\n    const pressing = {};\n    let loop;\n\n    load().then((newGame) => {\n      game.current = newGame;\n      loop = () => {\n        game.current.iterate(pressing);\n        setCounter((c) => c + 1);\n        requestAnimationFrame(loop);\n      };\n      loop();\n    });\n\n    const keydown = (e) => (pressing[e.code] = e.type === 'keydown');\n    const keypress = (e) => {\n      if (e.code === 'KeyP') game.current.makePoop();\n    };\n    window.addEventListener('keydown', keydown);\n    window.addEventListener('keyup', keydown);\n    window.addEventListener('keypress', keypress);\n\n    return () => {\n      window.removeEventListener('keydown', keydown);\n      window.removeEventListener('keyup', keydown);\n      window.removeEventListener('keypress', keypress);\n      cancelAnimationFrame(loop);\n    };\n  }, []);\n\n  return game.current;\n};\n\nconst GameContainer = () => {\n  const game = useGame();\n  return game && <Render {...game} />;\n};\n\ncreateRoot(document.querySelector('#root')).render(\n  <StrictMode>\n    <GameContainer />\n  </StrictMode>\n);\n","export const getBackground = (type) =>\n  type?.image ? `no-repeat center/contain url(${type.image})` : type?.color;\n"],"names":["initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","getDatabase","auth","getAuth","dbRef","ref","update","updates","onError","console","log","_update","e","error","message","window","x","loadData","things","Object","Promise","all","map","t","get","child","val","fromEntries","listen","pathStr","onChange","r","onValue","snapshot","off","logIn","email","pwd","signInWithEmailAndPassword","listenUser","onAuthStateChanged","logOut","signOut","Game","youPos","world","config","typeIndex","this","you","y","xs","ys","dirX","dirY","jewels","frame","digSpeed","eatSpeed","gravity","health","maxHealth","poop","maxPoop","jumpPower","moveSpeed","moveDeceleration","isNaN","Number","pressing","iterateYou","iterateTiles","KeyR","location","reload","KeyA","KeyD","KeyW","KeyS","jumping","Math","floor","ceil","key","interact","dx","dy","b","type","moveDelay","isEmpty","moveTile","liquid","left","right","random","block","onIntersect","abs","movable","collectible","healing","max","edible","Space","undefined","eaten","min","makePoop","diggable","dug","angle","atan2","PI","round","cos","sin","p","load","tileTypes","gameConfig","values","id","tileType","hash","length","JSON","parse","atob","slice","scale","Viewport","children","cx","innerWidth","cy","innerHeight","style","transform","Blocks","entries","className","background","getBackground","You","wombatAngle","wombatFlip","w","Bar","value","maxValue","color","width","Hud","src","j","image","Render","GameContainer","game","useRef","useState","setCounter","useEffect","loop","then","newGame","current","iterate","c","requestAnimationFrame","keydown","code","keypress","addEventListener","removeEventListener","cancelAnimationFrame","useGame","createRoot","document","querySelector","render","StrictMode"],"sourceRoot":""}