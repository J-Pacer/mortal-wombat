"use strict";(self.webpackChunkmortal_wombat=self.webpackChunkmortal_wombat||[]).push([[46],{46:function(e,t,n){n.r(t);var r=n(791),o=n(250),i=n(885),a=n(184),u=function(e){var t=e.errors,n=e.clearError;return Object.keys(t).length>0&&(0,a.jsx)("div",{className:"errorBanner",children:Object.entries(t).map((function(e){var t=(0,i.Z)(e,2),r=t[0],o=t[1];return(0,a.jsxs)("div",{children:[o," ",(0,a.jsx)("a",{onClick:function(){return n(r)},children:"[x]"})]},r)}))})},c=n(942),l=n(413),s=n(982),d=n(762),f=function(){return Date.now().toString(36)+":"+Math.random().toString(36).slice(2)},p=function(e,t){var n,r={},o=(0,d.Z)(t);try{for(o.s();!(n=o.n()).done;){var i=n.value;r[e(i)]=i}}catch(a){o.e(a)}finally{o.f()}return r},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.entries(e).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,l.Z)({key:n},r)}))},m=function(){var e=(0,r.useState)({}),t=(0,i.Z)(e,2),n=t[0],o=t[1];return[n,function(e){o((function(t){return(0,l.Z)((0,l.Z)({},t),{},(0,c.Z)({},f(),e))}))},function(e){return o((function(t){return function(e,t){var n=(0,l.Z)({},t);return delete n[e],n}(e,t)}))}]},v=n(861),y=n(757),b=n.n(y),x=n(63),g=function(e){var t=e.onError,n=(0,r.useState)(""),o=(0,i.Z)(n,2),u=o[0],c=o[1],l=(0,r.useState)(""),s=(0,i.Z)(l,2),d=s[0],f=s[1];return(0,a.jsx)("div",{style:{width:300,margin:"50px auto"},children:(0,a.jsxs)("form",{className:"login",onSubmit:function(){var e=(0,v.Z)(b().mark((function e(n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,(0,x.Ib)(u,d);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),t(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,a.jsx)("input",{type:"email",placeholder:"email",value:u,onChange:function(e){return c(e.target.value)}}),(0,a.jsx)("input",{type:"password",placeholder:"password",value:d,onChange:function(e){return f(e.target.value)}}),(0,a.jsx)("button",{style:{width:"100%"},children:"Log In"})]})})},w=function(e){var t=(0,r.useState)({}),n=(0,i.Z)(t,2),o=n[0],a=n[1];return(0,r.useEffect)((function(){return(0,x.oL)("users",(function(e){return a(function(e){return p((function(e){return e.email}),Object.values(e))}(e))}),e)}),[]),o},j=n(408),C=15e3,T=f(),S=function(e){var t=0;for(var n in e)t=Math.max(t,e[n].tstamp);return t},E=function(e){var t=(0,r.useState)({}),n=(0,i.Z)(t,2),o=n[0],a=n[1];return(0,r.useEffect)((function(){return(0,x.oL)("cursors",a,e)}),[]),(0,r.useEffect)((function(){Math.random()<.01&&function(e,t){var n={},r=S(e);for(var o in e)r-e[o].tstamp>C&&(n["cursors/"+o]=null);(0,x.Vx)(n,t)}(o,e)}),[o]),o},k=function(e,t){var n,r,o=!1,i=function i(){for(var a=arguments.length,u=new Array(a),c=0;c<a;c++)u[c]=arguments[c];o?r=u:(o=!0,n=setTimeout((function(){e.apply(void 0,u),o=!1,r&&i.apply(void 0,(0,s.Z)(r)),r=void 0}),t))};return i.cancel=function(){return clearTimeout(n)},i}((function(e,t,n,r,o,i,a){return(0,x.Vx)((0,c.Z)({},"cursors/".concat(T),{user:e.email,mouseX:t,mouseY:n,left:r-innerWidth/i/2,top:o-innerHeight/i/2,width:innerWidth/i,height:innerHeight/i,tstamp:(0,j.Bt)()}),a)}),500),N=function(e){var t=e.cursors,n=e.scale,o=e.userIndex,u=S(t);return Object.entries(t).map((function(e){var t,c,l=(0,i.Z)(e,2),s=l[0],d=l[1],f=d.user,p=d.left,h=d.top,m=d.width,v=d.height,y=d.tstamp,b=d.mouseX,x=d.mouseY;if(s===T||u-y>C)return null;var g=1-(u-y)/C;return(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)("div",{className:"cursorView",style:{left:p*n,top:h*n,width:m*n,height:v*n,opacity:g},children:(0,a.jsx)("span",{children:(null===(t=o[f])||void 0===t?void 0:t.name)||f})}),b&&x?(0,a.jsxs)("div",{className:"mouseCursor",style:{left:(b+.5)*n,top:(x+.5)*n,opacity:g},children:[(0,a.jsx)("i",{className:"fa-solid fa-arrow-pointer"}),(0,a.jsx)("span",{children:(null===(c=o[f])||void 0===c?void 0:c.name)||f})]}):null]},s)}))},Z=function(e,t,n,r){return{x:Math.floor((e.clientX-innerWidth/2)/t)+n,y:Math.floor((e.clientY-innerHeight/2)/t)+r}},I=function(e){return{background:e.image?"no-repeat center/contain url(".concat(e.image,")"):e.color}},O=function(e){var t=e.world,n=e.tileTypeIndex,r=e.scale;return Object.entries(t).filter((function(e){var t=(0,i.Z)(e,2),r=t[0],o=t[1];return!!n[o.tileType]||(console.log("BAD DATA",r,o),!1)})).map((function(e){var t=(0,i.Z)(e,2),o=t[0],u=t[1],c=u.x,s=u.y,d=u.tileType;return(0,a.jsx)("div",{className:"tile",style:(0,l.Z)({left:c*r+"px",top:s*r+"px"},I(n[d]))},o)}))},H=(0,r.memo)(O),M=function(e){var t=e.world,n=e.tileTypes,o=e.selectedTileTypeId,i=e.onError,u=e.xCoord,l=e.yCoord,s=e.scale,d=e.user,f=e.cursors,m=e.userIndex,v=(0,r.useRef)(),y=(0,r.useMemo)((function(){return p((function(e){return e.id}),h(n))}),[n]),b=function(e){var n=Z(e,s,u,l),r=n.x,a=n.y;if(e.altKey)return window.open(location.href.replace(/\?.*/,"")+"#"+btoa(JSON.stringify({x:r,y:a})),"_blank"),e.preventDefault(),!1;if(o){var f,p=null===(f=t["".concat(r,"_").concat(a)])||void 0===f?void 0:f.tileType,h=e.shiftKey?"_delete":o;!p&&"_delete"===h||p===h||function(e,t,n,r,o){(0,x.Vx)((0,c.Z)({},"world/".concat(e,"_").concat(t),"_delete"===n?null:{x:e,y:t,tileType:n}),r,o)}(r,a,h,d,i)}},g=(0,r.useCallback)((function(e){var t=Z(e,s,u,l),n=t.x,r=t.y;if(o){var a,c=null===(a=v.current)||void 0===a?void 0:a.style;c.left=n*s+"px",c.top=r*s+"px",e.buttons&&b(e)}k(d,n,r,u,l,s,i)}),[s,u,l,o,d]),w=innerWidth/2-u*s,j=innerHeight/2-l*s;return(0,a.jsx)("div",{className:"world",onClick:b,onMouseMove:g,children:(0,a.jsxs)("div",{style:{transform:"translate(".concat(w,"px,").concat(j,"px)")},children:[(0,a.jsx)(N,{cursors:f,scale:s,userIndex:m}),(0,a.jsx)(H,{world:t,tileTypeIndex:y,scale:s}),o&&(0,a.jsx)("div",{ref:v,className:"ghost tile",style:I(y[o])})]})})},A=function(e){var t=e.tileTypes,n=e.selectedTileTypeId,r=e.setSelectedTileTypeId,o=e.showTileTypeEditor,i=e.setShowTileTypeEditor;return(0,a.jsx)("div",{className:"toolBar",children:Object.values(t).sort((function(e,t){return e.order-t.order})).map((function(e){return(0,a.jsx)("div",{className:"tileType"+(n===e.id?" selected":""),style:I(e),title:o?"":"Double click to edit tile properties.",onClick:function(){i(!1),r(e.id)},onDoubleClick:function(){return e.id&&!e.id.startsWith("_")&&i(!0)},children:(0,a.jsx)("label",{children:e.label})},e.label)}))})},D={KeyS:"down",KeyA:"left",KeyW:"up",KeyD:"right",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"},L=function(e){var t,n=e.user,r=e.setScale,o=e.zoomAmt,i=e.userIndex,u=e.children;return(0,a.jsxs)("nav",{children:[n&&(0,a.jsxs)("div",{style:{float:"right"},children:[(0,a.jsx)("button",{onClick:function(){return r((function(e){return Math.round(e*o)}))},children:(0,a.jsx)("i",{className:"fa-solid fa-magnifying-glass-plus"})}),(0,a.jsx)("button",{onClick:function(){return r((function(e){return Math.round(e/o)}))},children:(0,a.jsx)("i",{className:"fa-solid fa-magnifying-glass-minus"})}),"Hi, ",(null===(t=i[n.email])||void 0===t?void 0:t.name)||n.email,"!",(0,a.jsx)("button",{onClick:x.ni,children:"log out"})]}),(0,a.jsx)("b",{children:"Game Editor"}),u]})},W={text:function(e){var t=e.value,n=void 0===t?"":t,r=e.onChange;return(0,a.jsx)("input",{type:"text",value:n,onChange:function(e){return r(e.target.value)}})},number:function(e){var t=e.value,n=void 0===t?"":t,r=e.onChange;return(0,a.jsx)("input",{type:"number",value:n,onChange:function(e){return r(e.target.value)}})},checkbox:function(e){var t=e.value,n=void 0!==t&&t,r=e.onChange;return(0,a.jsx)("input",{type:"checkbox",checked:n,onChange:function(e){return r(e.target.checked)}})}},V=function(e){var t=e.fields,n=e.data,r=e.onChange;return t.map((function(e){var t=e.prop,o=e.label,i=e.type,u=e.info,c=W[i];return(0,a.jsxs)("div",{title:u,children:[(0,a.jsx)("label",{children:o}),(0,a.jsx)(c,{value:null===n||void 0===n?void 0:n[t],onChange:function(e){return r(e,t)}})]},t)}))},Y=[{prop:"label",label:"Label",type:"text",info:"The label you see in the tool bar below."},{prop:"image",label:"Image URL",type:"text",info:"The image. uhduhhhh"},{prop:"color",label:"Color",type:"text",info:"The color to use if there is no image"},{prop:"healing",label:"Healing",type:"number",info:"How much does it heal (or hurt) when you eat/touch it (per frame)?"},{prop:"makePoop",label:"Make Poop",type:"number",info:"How much poop does it make?"},{prop:"edible",label:"Edible",type:"checkbox",info:"Can you eat it?"},{prop:"diggable",label:"Diggable",type:"checkbox",info:"Can you dig it?"},{prop:"collectible",label:"Collectible",type:"checkbox",info:"Can you collect it?"},{prop:"movable",label:"Movable",type:"checkbox",info:"Can you push it?"},{prop:"order",label:"Order",type:"number",info:"The order it shows up in the toolbar below"}],_=function(e){var t=e.selectedTileTypeId,n=e.tileTypes,r=e.user,o=e.onError,i=h(n).find((function(e){return e.id===t}));return i&&(0,a.jsx)("div",{className:"tileTypeEditor",children:(0,a.jsx)(V,{fields:Y,data:i,onChange:function(e,t){(0,x.Vx)((0,c.Z)({},"tileTypes/".concat(i.key,"/").concat(t),e),r,o)}})})},B=function(e,t){var n=(0,r.useState)(void 0===localStorage[e]?t:function(e,t){try{return JSON.parse(e)}catch(n){return console.error(n),t}}(localStorage[e],t)),o=(0,i.Z)(n,2),a=o[0],u=o[1];return(0,r.useEffect)((function(){localStorage[e]=JSON.stringify(a)}),[a]),[a,u]},X=[{prop:"digSpeed",label:"Wombat Digging Speed",type:"number",info:"How fast much can you dig in one frame?"},{prop:"eatSpeed",label:"Wombat Eating Speed",type:"number",info:"How fast much can you eat in one frame?"},{prop:"gravity",label:"Gravity",type:"number",info:"How strong is gravity?"},{prop:"health",label:"Wombat Starting Health",type:"number",info:"How much health do you start with?"},{prop:"jumpPower",label:"Wombat Jumping Power",type:"number",info:"How much jumping power do you start with?"},{prop:"moveSpeed",label:"Wombat Acceleration",type:"number",info:"How fast can you move?"},{prop:"moveDeceleration",label:"Wombat Deceleration",type:"number",info:"How fast can you slow down?"},{prop:"magmaDelay",label:"Magma Delay",type:"number",info:"Number of frames between magma movements"}],K=function(e){var t=e.onError,n=e.user,o=function(e){var t=(0,r.useState)(),n=(0,i.Z)(t,2),o=n[0],a=n[1];return(0,r.useEffect)((function(){return(0,x.oL)("gameConfig",a,e)}),[]),o}(t);return(0,a.jsx)("div",{className:"gameConfig",children:(0,a.jsx)(V,{fields:X,data:o,onChange:function(e,r){(0,x.Vx)((0,c.Z)({},"gameConfig/".concat(r),e),n,t)}})})},P=function(e,t){var n,r=function(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];clearTimeout(n),n=setTimeout((function(){return e.apply(void 0,o)}),t)};return r.cancel=function(){return clearTimeout(n)},r}((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];location.hash=t.join("/")}),1e3),G=function(e){var t=e.className,n=e.hide,r=e.label,o=e.children;return(0,a.jsxs)("div",{className:"pane ".concat(t),children:[(0,a.jsxs)("header",{children:[(0,a.jsx)("a",{onClick:n,children:"[x]"}),(0,a.jsx)("strong",{children:r})]}),o]})},J=function(e){var t=e.cursors,n=e.userIndex,r=S(t);return Object.entries(t).filter((function(e){return r-e[1].tstamp<C})).sort((function(e,t){return t[1].tstamp-e[1].tstamp})).map((function(e){var t,r=(0,i.Z)(e,2),o=r[0],u=r[1],c=u.user,l=u.mouseX,s=u.mouseY;return(0,a.jsxs)("div",{style:{margin:5},children:[(null===(t=n[c])||void 0===t?void 0:t.name)||c,l&&s&&(0,a.jsx)("a",{className:"button",style:{margin:"0 10px"},href:"#".concat(l,"/").concat(s,"/32"),children:"go"})]},o)}))},U=[{key:"gameConfig",label:"Config",icon:"toolbox"},{key:"tileTypeEditor",label:"Tile Type Editor",hideButton:!0},{key:"hereNow",label:"People",icon:"person"},{key:"debug",label:"Debug",icon:"bug"}],R=function(){var e,t=m(),n=(0,i.Z)(t,3),o=n[0],c=n[1],l=n[2],s=function(){var e=(0,r.useState)(),t=(0,i.Z)(e,2),n=t[0],o=t[1];return(0,r.useEffect)((function(){return(0,x.G9)(o)}),[]),n}(),d=w(c),f=function(e){var t=(0,r.useState)(),n=(0,i.Z)(t,2),o=n[0],a=n[1];return(0,r.useEffect)((function(){return(0,x.oL)("tileTypes",a,e)}),[]),o}(c),p=function(e){var t=(0,r.useState)({}),n=(0,i.Z)(t,2),o=n[0],a=n[1];return(0,r.useEffect)((function(){return(0,x.oL)("world",a,e)}),[]),o}(c),h=E(c),v=(0,r.useState)(),y=(0,i.Z)(v,2),b=y[0],j=y[1],C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,r.useState)(e),o=(0,i.Z)(n,2),a=o[0],u=o[1],c=(0,r.useState)(t),l=(0,i.Z)(c,2),s=l[0],d=l[1];return(0,r.useEffect)((function(){var e=function(e){if(e.target===document.body){var t=D[e.code];"up"===t&&d((function(e){return e-4})),"down"===t&&d((function(e){return e+4})),"left"===t&&u((function(e){return e-4})),"right"===t&&u((function(e){return e+4}))}};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[]),{xCoord:a,yCoord:s,setXCoord:u,setYCoord:d}}(0,0),T=C.xCoord,S=C.yCoord,N=C.setXCoord,Z=C.setYCoord,I=(0,r.useState)(32),O=(0,i.Z)(I,2),H=O[0],W=O[1],V=(e=U,Object.fromEntries(e.map((function(e){var t=e.key,n=e.label,r=e.icon,o=e.hideButton,u=B("show"+n,!1),c=(0,i.Z)(u,2),l=c[0],s=c[1];return[t,{key:t,label:n,button:!o&&(0,a.jsxs)("button",{className:l?"active":"",onClick:function(){return s((function(e){return!e}))},children:[(0,a.jsx)("i",{className:"fa-solid fa-".concat(r)})," ",n]},t),show:l,setShow:s}]}))));return(0,r.useEffect)((function(){document.documentElement.style.setProperty("--scale",H+"px")}),[H]),function(e){var t=e.xCoord,n=e.yCoord,o=e.scale,a=e.setXCoord,u=e.setYCoord,c=e.setScale;(0,r.useEffect)((function(){return P(t,n,o),P.cancel}),[o,t,n]),(0,r.useEffect)((function(){var e=function(){var e=location.hash.slice(1).split("/").map(Number);if(3===e.length&&e.every((function(e){return!isNaN(e)}))){var t=(0,i.Z)(e,3),n=t[0],r=t[1],o=t[2];a(n),u(r),c(o)}};return e(),window.addEventListener("hashchange",e),function(){window.removeEventListener("hashchange",e)}}),[])}({xCoord:T,yCoord:S,scale:H,setXCoord:N,setYCoord:Z,setScale:W}),(0,r.useEffect)((function(){s&&k(s,null,null,T,S,H,c)}),[s,T,S,H]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L,{user:s,scale:H,setScale:W,zoomAmt:2,userIndex:d,children:Object.values(V).map((function(e){return e.button}))}),(0,a.jsx)(u,{errors:o,clearError:l}),s?(0,a.jsxs)("div",{className:"appContainer",children:[V.debug.show&&(0,a.jsx)(G,{label:V.debug.label,className:"debugContainer",hide:function(){return V.debug.setShow(!1)},children:(0,a.jsx)("textarea",{readOnly:!0,value:JSON.stringify({xCoord:T,yCoord:S,scale:H,selectedTileTypeId:b,errors:o,user:s,cursors:h},null,2)})}),b&&f&&V.tileTypeEditor.show&&Object.values(f).some((function(e){return e.id===b}))&&(0,a.jsx)(G,{label:V.tileTypeEditor.label,className:V.tileTypeEditor.key+"Container",hide:function(){return V.tileTypeEditor.setShow(!1)},children:(0,a.jsx)(_,{selectedTileTypeId:b,tileTypes:f,user:s,onError:c})}),V.gameConfig.show&&(0,a.jsx)(G,{label:"Game Config",className:"gameConfigContainer",hide:function(){return V.gameConfig.setShow(!1)},children:(0,a.jsx)(K,{onError:c,user:s})}),V.hereNow.show&&(0,a.jsx)(G,{label:"Using the Editor Right Now",className:"hereNowContainer",hide:function(){return V.hereNow.setShow(!1)},children:(0,a.jsx)(J,{cursors:h,userIndex:d})}),f&&(0,a.jsx)("div",{className:"toolContainer",children:(0,a.jsx)(A,{tileTypes:f,selectedTileTypeId:b,setSelectedTileTypeId:j,showTileTypeEditor:V.tileTypeEditor.show,setShowTileTypeEditor:V.tileTypeEditor.setShow})}),p&&f&&(0,a.jsx)("div",{className:"worldEditorContainer",children:(0,a.jsx)(M,{world:p,selectedTileTypeId:b,tileTypes:f,onError:c,xCoord:T,yCoord:S,scale:H,user:s,cursors:h,userIndex:d})})]}):(0,a.jsx)(g,{onError:c})]})};document.title="Mortal Wombat Editor",(0,o.s)(document.querySelector("#root")).render((0,a.jsx)(r.StrictMode,{children:(0,a.jsx)(R,{})}))},63:function(e,t,n){n.d(t,{G9:function(){return v},Ib:function(){return m},Vx:function(){return f},mu:function(){return p},ni:function(){return y},oL:function(){return h}});var r=n(861),o=n(757),i=n.n(o),a=n(426),u=n(408),c=n(162);(0,a.ZF)({apiKey:"AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I",authDomain:"mortal-wombat-8c76a.firebaseapp.com",projectId:"mortal-wombat-8c76a",storageBucket:"mortal-wombat-8c76a.appspot.com",messagingSenderId:"929181149015",appId:"1:929181149015:web:33a7f450bcdbb06ae64012",measurementId:"G-JL6HCMYYBS"});var l=(0,u.N8)(),s=(0,c.v0)(),d=(0,u.iH)(l),f=function(e,t){try{return console.log("updates",e),(0,u.Vx)(d,e)}catch(n){console.error(n),t(n.message)}};window._update=function(){var e=(0,r.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,(0,u.Vx)(d,t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.log.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var p=function(){var e=(0,r.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Object,e.next=3,Promise.all(t.map(function(){var e=(0,r.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,(0,u.U2)((0,u.iU)(d,t));case 3:return e.t1=e.sent.val(),e.abrupt("return",[e.t0,e.t1]);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.fromEntries.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(e,t,n){try{var r=(0,u.iH)(l,e);return(0,u.jM)(r,(function(e){return t(e.val())})),function(){return(0,u.S1)(r)}}catch(o){console.error(o),n(o.message)}},m=function(e,t){return(0,c.e5)(s,e,t)},v=function(e){return(0,c.Aj)(s,e)},y=function(){return(0,c.w7)(s)}}}]);
//# sourceMappingURL=46.c50fd08f.chunk.js.map