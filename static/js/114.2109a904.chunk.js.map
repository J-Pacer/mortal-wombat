{"version":3,"file":"static/js/114.2109a904.chunk.js","mappings":"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","sources":["firebase.js","game/Game.js","game/Renderer.js","game/main.js"],"sourcesContent":["import {initializeApp} from 'firebase/app';\nimport {\n  ref,\n  getDatabase,\n  update as _update,\n  onValue,\n  off,\n  get,\n  child,\n} from 'firebase/database';\nimport {\n  getAuth,\n  signInWithEmailAndPassword,\n  onAuthStateChanged,\n  signOut,\n} from 'firebase/auth';\n\ninitializeApp({\n  apiKey: 'AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I',\n  authDomain: 'mortal-wombat-8c76a.firebaseapp.com',\n  projectId: 'mortal-wombat-8c76a',\n  storageBucket: 'mortal-wombat-8c76a.appspot.com',\n  messagingSenderId: '929181149015',\n  appId: '1:929181149015:web:33a7f450bcdbb06ae64012',\n  measurementId: 'G-JL6HCMYYBS',\n});\n\n/*\n\nData:\nhttps://console.firebase.google.com/project/mortal-wombat-8c76a/database/mortal-wombat-8c76a-default-rtdb/data\nData Docs: https://firebase.google.com/docs/database/web/read-and-write?hl=en&authuser=0\n\nUsers:\nhttps://console.firebase.google.com/project/mortal-wombat-8c76a/authentication/users\nUser Docs: https://firebase.google.com/docs/auth/web/manage-users\n\n\n*/\n\nconst db = getDatabase();\nconst auth = getAuth();\nconst dbRef = ref(db);\n\n// {path1: val1, path2: val2}\nexport const update = (updates, onError) => {\n  try {\n    console.log('updates', updates);\n    return _update(dbRef, updates);\n  } catch (e) {\n    console.error(e);\n    onError(e.message);\n  }\n};\n\nwindow._update = async (x) => console.log(await _update(dbRef, x));\n\n// export const updateWithHistory = (data, user, onError) =>\n//   update(\n//     {\n//       ...data,\n//       [`history/${guid()}`]: {\n//         update: JSON.stringify(data),\n//         user: user.email,\n//         tstamp: serverTimestamp(),\n//       },\n//     },\n//     onError\n//   );\n\nexport const loadData = async (things) =>\n  Object.fromEntries(\n    await Promise.all(\n      things.map(async (t) => [t, (await get(child(dbRef, t))).val()])\n    )\n  );\n\nexport const listen = (pathStr, onChange, onError) => {\n  try {\n    const r = ref(db, pathStr);\n    onValue(r, (snapshot) => onChange(snapshot.val()));\n    return () => off(r);\n  } catch (e) {\n    console.error(e);\n    onError(e.message);\n  }\n};\n\n// export const createUser = async (email, pwd) => {\n//   try {\n//     const result = await createUserWithEmailAndPassword(auth, email, pwd);\n//     return result.user;\n//   } catch (e) {\n//     console.error(e);\n//     return e.message;\n//   }\n// };\n\nexport const logIn = (email, pwd) =>\n  signInWithEmailAndPassword(auth, email, pwd);\n\nexport const listenUser = (onChange) => onAuthStateChanged(auth, onChange);\n\nexport const logOut = () => signOut(auth);\n","const onIntersect = (game, you, block, pressing) => {\n  if (block.type.collectible) {\n    you.jewels++;\n    return true;\n  }\n\n  if (block.type.healing < 0) {\n    game.health = Math.max(0, game.health + Number(block.type.healing));\n  }\n\n  if (block.type.edible && pressing.Space) {\n    if (block.eaten === undefined) block.eaten = 1;\n    block.eaten -= game.eatSpeed;\n    game.health = Math.min(\n      game.maxHealth,\n      game.health + block.type.healing * game.eatSpeed\n    );\n    game.poop = Math.min(\n      game.maxPoop,\n      game.poop + block.type.makePoop * game.eatSpeed\n    );\n    if (block.eaten <= 0) return true;\n  }\n\n  if (block.type.diggable && pressing.Space) {\n    if (block.dug === undefined) block.dug = 1;\n    block.dug -= game.digSpeed;\n    if (block.dug <= 0) return true;\n  }\n};\n\n// if returns true, then delete block\nconst interact = (game, you, block, pressing) => {\n  if (onIntersect(game, you, block, pressing)) return true;\n  const dx = you.x - block.x;\n  const dy = you.y - block.y;\n  if (Math.abs(dx) > Math.abs(dy)) {\n    you.x = block.x + (you.x < block.x ? -1 : 1);\n    you.xs = 0;\n  } else {\n    if (you.y < block.y) you.jumping = false;\n    you.y = block.y + (you.y < block.y ? -1 : 1);\n    you.ys = 0;\n  }\n};\n\nexport class Game {\n  constructor(youPos, blocks, config) {\n    this.blocks = blocks;\n    this.frame = 0;\n    this.you = {\n      x: 0,\n      y: 0,\n      xs: 0,\n      ys: 0,\n      dirX: 1,\n      dirY: 0,\n      jewels: 0,\n      ...youPos,\n    };\n\n    // these can all be overridden by config\n    this.digSpeed = 0.05;\n    this.eatSpeed = 0.05;\n    this.gravity = 0.005;\n    this.health = 100;\n    this.maxHealth = 100; // TODO\n    this.poop = 0; // TODO\n    this.maxPoop = 10; // TODO\n    this.jumpPower = 0.11;\n    this.magmaDelay = 30;\n    this.moveSpeed = 0.015;\n    this.moveDeceleration = 0.3;\n\n    for (const x in config) {\n      if (!isNaN(config[x])) this[x] = Number(config[x]); // because editing them turns them into strings, yayyyy\n    }\n  }\n  iterate(pressing) {\n    this.iterateYou(pressing);\n    if (this.frame % this.magmaDelay === 0) this.iterateMagma();\n    this.frame++;\n  }\n  iterateYou(pressing) {\n    const {you, blocks, gravity} = this;\n\n    if (this.health <= 0) {\n      if (pressing.KeyR) location.reload();\n      return;\n    }\n\n    if (pressing.KeyA || pressing.KeyD || pressing.KeyW || pressing.KeyS) {\n      you.dirX = 0;\n      you.dirY = 0;\n    }\n    if (pressing.KeyA) {\n      you.xs -= this.moveSpeed;\n      you.dirX--;\n    }\n    if (pressing.KeyD) {\n      you.xs += this.moveSpeed;\n      you.dirX++;\n    }\n    if (pressing.KeyW) {\n      if (!you.jumping && !you.ys) {\n        you.ys -= this.jumpPower;\n        you.jumping = true;\n      }\n      you.dirY--;\n    }\n    if (pressing.KeyS) {\n      you.dirY++;\n    }\n    you.x += you.xs;\n    you.xs *= 1 - this.moveDeceleration;\n    you.ys += gravity;\n    you.y += you.ys;\n\n    for (const key of [\n      `${Math.floor(you.x)}_${Math.floor(you.y)}`,\n      `${Math.ceil(you.x)}_${Math.floor(you.y)}`,\n      `${Math.floor(you.x)}_${Math.ceil(you.y)}`,\n      `${Math.ceil(you.x)}_${Math.ceil(you.y)}`,\n    ]) {\n      if (blocks[key]) {\n        const shouldDelete = interact(this, you, blocks[key], pressing);\n        if (shouldDelete) delete blocks[key];\n      }\n    }\n  }\n  isEmpty(x, y) {\n    return !this.blocks[`${x}_${y}`];\n  }\n  move(x, y, dx, dy) {\n    const key = `${x}_${y}`;\n    const b = this.blocks[key];\n    delete this.blocks[key];\n    b.x += dx;\n    b.y += dy;\n    this.blocks[`${b.x}_${b.y}`] = b;\n  }\n  iterateMagma() {\n    const magma = Object.values(this.blocks)\n      .filter((b) => b.type.movement === 'liquid')\n      .sort((a, b) => (a.y === b.y ? Math.random() - 0.5 : a.y - b.y));\n\n    for (const b of magma) {\n      if (this.isEmpty(b.x, b.y + 1)) {\n        this.move(b.x, b.y, 0, 1);\n      } else {\n        const left = this.isEmpty(b.x - 1, b.y);\n        const right = this.isEmpty(b.x + 1, b.y);\n        if (left && right) {\n          this.move(b.x, b.y, Math.random() < 0.5 ? 1 : -1, 0);\n        } else if (left) {\n          this.move(b.x, b.y, -1, 0);\n        } else if (right) {\n          this.move(b.x, b.y, 1, 0);\n        }\n      }\n    }\n  }\n}\n","const SCALE = 32;\n\nconst shadowText = (ctx, text, x, y, color, offset) => {\n  ctx.fillStyle = 'black';\n  ctx.fillText(text, x + offset, y + offset);\n  ctx.fillStyle = color;\n  ctx.fillText(text, x, y);\n};\n\nconst bar = (ctx, value, maxValue, color, x, y, width, height) => {\n  ctx.fillStyle = color;\n  ctx.fillRect(x, y, (value / maxValue) * width, height);\n  ctx.strokeStyle = 'white';\n  ctx.strokeRect(x, y, width, height);\n  ctx.fillStyle = 'white';\n  ctx.font = '18px sans-serif';\n  ctx.textAlign = 'left';\n  ctx.textBaseline = 'top';\n  ctx.fillText(Math.floor(value), x + 2, y + 1);\n};\n\nexport class Renderer {\n  constructor(canvas) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d', {antialias: false, depth: false});\n    this.resize();\n    window.addEventListener('resize', () => this.resize());\n  }\n  resize() {\n    const {canvas} = this;\n    this.width = canvas.width = innerWidth;\n    this.height = canvas.height = innerHeight;\n  }\n  render({you, health, maxHealth, poop, maxPoop, blocks}) {\n    const {ctx, width, height} = this;\n\n    ctx.clearRect(0, 0, width, height);\n    ctx.save();\n    ctx.translate(\n      width / 2 - you.x * SCALE - SCALE / 2,\n      height / 2 - you.y * SCALE - SCALE / 2\n    );\n\n    for (const {x, y, type} of Object.values(blocks)) {\n      ctx.fillStyle = type.color;\n      ctx.fillRect(x * SCALE, y * SCALE, SCALE, SCALE);\n    }\n\n    ctx.fillStyle = 'red';\n    ctx.fillRect(you.x * SCALE, you.y * SCALE, SCALE, SCALE);\n    const angle = Math.atan2(you.dirY, you.dirX);\n    ctx.strokeStyle = 'black';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo((you.x + 0.5) * SCALE, (you.y + 0.5) * SCALE);\n    ctx.lineTo(\n      (you.x + 0.5) * SCALE + (Math.cos(angle) * SCALE) / 2,\n      (you.y + 0.5) * SCALE + (Math.sin(angle) * SCALE) / 2\n    );\n    ctx.stroke();\n\n    ctx.restore();\n\n    // HUD\n    if (health > 0) {\n      bar(\n        ctx,\n        health,\n        maxHealth,\n        health > 30 ? 'green' : 'red',\n        10,\n        10,\n        500,\n        20\n      );\n      bar(ctx, poop, maxPoop, 'brown', 10, 40, 500, 20);\n    } else {\n      ctx.textBaseline = 'middle';\n      ctx.textAlign = 'center';\n      ctx.font = '120px sans-serif';\n      shadowText(ctx, 'you dead', innerWidth / 2, innerHeight / 2, 'red', 5);\n      ctx.font = '32px sans-serif';\n      shadowText(\n        ctx,\n        'press R to try again',\n        innerWidth / 2,\n        innerHeight / 2 + 60,\n        '#AFF',\n        3\n      );\n    }\n  }\n}\n","import {loadData} from '../firebase.js';\nimport {Game} from './Game.js';\nimport {Renderer} from './Renderer.js';\n\nconst init = async () => {\n  const {tileTypes, world, gameConfig} = await loadData([\n    'tileTypes',\n    'world',\n    'gameConfig',\n  ]);\n\n  const typeIndex = {};\n  let you;\n  for (const type of Object.values(tileTypes)) {\n    typeIndex[type.id] = type;\n  }\n  for (const key in world) {\n    const {x, y, tileType} = world[key];\n    if (tileType === 'w') {\n      you = {x, y};\n      delete world[key];\n    } else {\n      world[key] = {x, y, type: typeIndex[tileType]};\n    }\n  }\n\n  if (location.hash.length > 1) {\n    try {\n      you = JSON.parse(atob(location.hash.slice(1)));\n    } catch (e) {\n      console.log('bad hash', e);\n    }\n  }\n\n  console.log(gameConfig);\n  const game = new Game(you, world, gameConfig);\n\n  const canvas = document.createElement('canvas');\n  document.body.append(canvas);\n  document.body.style.background = 'black';\n  document.body.style.margin = 0;\n  document.body.style.overflow = 'hidden';\n  const renderer = new Renderer(canvas);\n  const pressing = {};\n\n  const loop = () => {\n    game.iterate(pressing);\n    renderer.render(game, tileTypes);\n    requestAnimationFrame(loop);\n  };\n  loop();\n\n  const keypress = (e) => (pressing[e.code] = e.type === 'keydown');\n  window.addEventListener('keydown', keypress);\n  window.addEventListener('keyup', keypress);\n};\n\ninit();\n"],"names":["initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","getDatabase","auth","getAuth","dbRef","ref","update","updates","onError","console","log","_update","e","error","message","window","x","loadData","things","Object","Promise","all","map","t","get","child","val","fromEntries","listen","pathStr","onChange","r","onValue","snapshot","off","logIn","email","pwd","signInWithEmailAndPassword","listenUser","onAuthStateChanged","logOut","signOut","interact","game","you","block","pressing","type","collectible","jewels","healing","health","Math","max","Number","edible","Space","undefined","eaten","eatSpeed","min","maxHealth","poop","maxPoop","makePoop","diggable","dug","digSpeed","onIntersect","dx","dy","y","abs","xs","jumping","ys","Game","youPos","blocks","config","this","frame","dirX","dirY","gravity","jumpPower","magmaDelay","moveSpeed","moveDeceleration","isNaN","iterateYou","iterateMagma","KeyR","location","reload","KeyA","KeyD","KeyW","KeyS","floor","ceil","key","b","magma","values","filter","movement","sort","a","random","isEmpty","move","left","right","SCALE","shadowText","ctx","text","color","offset","fillStyle","fillText","bar","value","maxValue","width","height","fillRect","strokeStyle","strokeRect","font","textAlign","textBaseline","Renderer","canvas","getContext","antialias","depth","resize","addEventListener","innerWidth","innerHeight","clearRect","save","translate","angle","atan2","lineWidth","beginPath","moveTo","lineTo","cos","sin","stroke","restore","init","tileTypes","world","gameConfig","typeIndex","id","tileType","hash","length","JSON","parse","atob","slice","document","createElement","body","append","style","background","margin","overflow","renderer","loop","iterate","render","requestAnimationFrame","keypress","code"],"sourceRoot":""}