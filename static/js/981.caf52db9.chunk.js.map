{"version":3,"file":"static/js/981.caf52db9.chunk.js","mappings":"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","sources":["firebase.js","game/Game.js","game/load.js","game/main.js","utils/getBackground.js"],"sourcesContent":["import {initializeApp} from 'firebase/app';\nimport {\n  ref,\n  getDatabase,\n  update as _update,\n  onValue,\n  off,\n  get,\n  child,\n} from 'firebase/database';\nimport {\n  getAuth,\n  signInWithEmailAndPassword,\n  onAuthStateChanged,\n  signOut,\n} from 'firebase/auth';\n\ninitializeApp({\n  apiKey: 'AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I',\n  authDomain: 'mortal-wombat-8c76a.firebaseapp.com',\n  projectId: 'mortal-wombat-8c76a',\n  storageBucket: 'mortal-wombat-8c76a.appspot.com',\n  messagingSenderId: '929181149015',\n  appId: '1:929181149015:web:33a7f450bcdbb06ae64012',\n  measurementId: 'G-JL6HCMYYBS',\n});\n\n/*\n\nData:\nhttps://console.firebase.google.com/project/mortal-wombat-8c76a/database/mortal-wombat-8c76a-default-rtdb/data\nData Docs: https://firebase.google.com/docs/database/web/read-and-write?hl=en&authuser=0\n\nUsers:\nhttps://console.firebase.google.com/project/mortal-wombat-8c76a/authentication/users\nUser Docs: https://firebase.google.com/docs/auth/web/manage-users\n\n\n*/\n\nconst db = getDatabase();\nconst auth = getAuth();\nconst dbRef = ref(db);\n\n// {path1: val1, path2: val2}\nexport const update = (updates, onError) => {\n  try {\n    console.log('updates', updates);\n    return _update(dbRef, updates);\n  } catch (e) {\n    console.error(e);\n    onError(e.message);\n  }\n};\n\nwindow._update = async (x) => console.log(await _update(dbRef, x));\n\n// export const updateWithHistory = (data, user, onError) =>\n//   update(\n//     {\n//       ...data,\n//       [`history/${guid()}`]: {\n//         update: JSON.stringify(data),\n//         user: user.email,\n//         tstamp: serverTimestamp(),\n//       },\n//     },\n//     onError\n//   );\n\nexport const loadData = async (things) =>\n  Object.fromEntries(\n    await Promise.all(\n      things.map(async (t) => [t, (await get(child(dbRef, t))).val()])\n    )\n  );\n\nexport const listen = (pathStr, onChange, onError) => {\n  try {\n    const r = ref(db, pathStr);\n    onValue(r, (snapshot) => onChange(snapshot.val()));\n    return () => off(r);\n  } catch (e) {\n    console.error(e);\n    onError(e.message);\n  }\n};\n\n// export const createUser = async (email, pwd) => {\n//   try {\n//     const result = await createUserWithEmailAndPassword(auth, email, pwd);\n//     return result.user;\n//   } catch (e) {\n//     console.error(e);\n//     return e.message;\n//   }\n// };\n\nexport const logIn = (email, pwd) =>\n  signInWithEmailAndPassword(auth, email, pwd);\n\nexport const listenUser = (onChange) => onAuthStateChanged(auth, onChange);\n\nexport const logOut = () => signOut(auth);\n","export class Game {\n  constructor(youPos, blocks, config, typeIndex) {\n    this.blocks = blocks;\n    this.typeIndex = typeIndex;\n    this.frame = 0;\n    this.you = {\n      x: 0,\n      y: 0,\n      xs: 0,\n      ys: 0,\n      dirX: 1,\n      dirY: 0,\n      ...youPos,\n    };\n    this.jewels = 0;\n\n    // these can all be overridden by config\n    this.digSpeed = 0.05;\n    this.eatSpeed = 0.05;\n    this.gravity = 0.005;\n    this.health = 100;\n    this.maxHealth = 100; // TODO\n    this.poop = 0; // TODO\n    this.maxPoop = 10; // TODO\n    this.jumpPower = 0.11;\n    this.magmaDelay = 30;\n    this.moveSpeed = 0.015;\n    this.moveDeceleration = 0.3;\n\n    for (const x in config) {\n      if (!isNaN(config[x])) this[x] = Number(config[x]); // because editing them turns them into strings, yayyyy\n    }\n  }\n  iterate(pressing) {\n    this.iterateYou(pressing);\n    if (this.frame % this.magmaDelay === 0) this.iterateMagma();\n    this.frame++;\n    return this;\n  }\n  iterateYou(pressing) {\n    const {you, blocks, gravity} = this;\n\n    if (this.health <= 0) {\n      if (pressing.KeyR) location.reload();\n      return;\n    }\n\n    if (pressing.KeyA || pressing.KeyD || pressing.KeyW || pressing.KeyS) {\n      you.dirX = 0;\n      you.dirY = 0;\n    }\n    if (pressing.KeyA) {\n      you.xs -= this.moveSpeed;\n      you.dirX--;\n    }\n    if (pressing.KeyD) {\n      you.xs += this.moveSpeed;\n      you.dirX++;\n    }\n    if (pressing.KeyW) {\n      if (!you.jumping && !you.ys) {\n        you.ys -= this.jumpPower;\n        you.jumping = true;\n      }\n      you.dirY--;\n    }\n    if (pressing.KeyS) {\n      you.dirY++;\n    }\n    you.x += you.xs;\n    you.xs *= 1 - this.moveDeceleration;\n    you.ys += gravity;\n    you.y += you.ys;\n\n    for (const key of [\n      `${Math.floor(you.x)}_${Math.floor(you.y)}`,\n      `${Math.ceil(you.x)}_${Math.floor(you.y)}`,\n      `${Math.floor(you.x)}_${Math.ceil(you.y)}`,\n      `${Math.ceil(you.x)}_${Math.ceil(you.y)}`,\n    ]) {\n      if (blocks[key]) {\n        const shouldDelete = this.interact(you, blocks[key], pressing);\n        if (shouldDelete) delete blocks[key];\n      }\n    }\n  }\n  isEmpty(x, y) {\n    return !this.blocks[`${x}_${y}`];\n  }\n  move(x, y, dx, dy) {\n    const key = `${x}_${y}`;\n    const b = this.blocks[key];\n    delete this.blocks[key];\n    b.x += dx;\n    b.y += dy;\n    this.blocks[`${b.x}_${b.y}`] = b;\n  }\n  iterateMagma() {\n    const magma = Object.values(this.blocks)\n      .filter((b) => b.type.movement === 'liquid')\n      .sort((a, b) => (a.y === b.y ? Math.random() - 0.5 : a.y - b.y));\n\n    for (const b of magma) {\n      if (this.isEmpty(b.x, b.y + 1)) {\n        this.move(b.x, b.y, 0, 1);\n      } else {\n        const left = this.isEmpty(b.x - 1, b.y);\n        const right = this.isEmpty(b.x + 1, b.y);\n        if (left && right) {\n          this.move(b.x, b.y, Math.random() < 0.5 ? 1 : -1, 0);\n        } else if (left) {\n          this.move(b.x, b.y, -1, 0);\n        } else if (right) {\n          this.move(b.x, b.y, 1, 0);\n        }\n      }\n    }\n  }\n  // if returns true, then delete block\n  interact(you, block, pressing) {\n    if (this.onIntersect(block, pressing)) return true;\n    const dx = you.x - block.x;\n    const dy = you.y - block.y;\n    if (Math.abs(dx) > Math.abs(dy)) {\n      you.x = block.x + (you.x < block.x ? -1 : 1);\n      you.xs = 0;\n    } else {\n      if (you.y < block.y) you.jumping = false;\n      you.y = block.y + (you.y < block.y ? -1 : 1);\n      you.ys = 0;\n    }\n  }\n  onIntersect(block, pressing) {\n    if (block.type.collectible) {\n      this.jewels++;\n      return true;\n    }\n\n    if (block.type.healing < 0) {\n      this.health = Math.max(0, this.health + Number(block.type.healing));\n    }\n\n    if (block.type.edible && pressing.Space) {\n      if (block.eaten === undefined) block.eaten = 1;\n      block.eaten -= this.eatSpeed;\n      this.health = Math.min(\n        this.maxHealth,\n        this.health + block.type.healing * this.eatSpeed\n      );\n      this.poop = Math.min(\n        this.maxPoop,\n        this.poop + block.type.makePoop * this.eatSpeed\n      );\n      if (block.eaten <= 0) return true;\n    }\n\n    if (block.type.diggable && pressing.Space) {\n      if (block.dug === undefined) block.dug = 1;\n      block.dug -= this.digSpeed;\n      if (block.dug <= 0) return true;\n    }\n  }\n}\n","import {loadData} from '../firebase';\nimport {Game} from './Game';\n\nexport const load = async () => {\n  const {tileTypes, world, gameConfig} = await loadData([\n    'tileTypes',\n    'world',\n    'gameConfig',\n  ]);\n\n  const typeIndex = {};\n  let you;\n  for (const type of Object.values(tileTypes)) {\n    typeIndex[type.id] = type;\n  }\n  for (const key in world) {\n    const {x, y, tileType} = world[key];\n    if (tileType === 'w') {\n      you = {x, y};\n      delete world[key];\n    } else {\n      world[key] = {x, y, type: typeIndex[tileType]};\n    }\n  }\n\n  if (location.hash.length > 1) {\n    try {\n      you = JSON.parse(atob(location.hash.slice(1)));\n    } catch (e) {\n      console.log('bad hash', e);\n    }\n  }\n\n  return new Game(you, world, gameConfig, typeIndex);\n};\n","import {StrictMode, useEffect, useRef, useState} from 'react';\nimport {createRoot} from 'react-dom/client';\nimport {getBackground} from '../utils/getBackground';\nimport './game.css';\nimport {load} from './load';\n\nconst scale = 48;\n\nconst Viewport = ({you, children}) => {\n  const cx = innerWidth / 2 - you.x * scale;\n  const cy = innerHeight / 2 - you.y * scale;\n  return (\n    <div style={{transform: `translate(${cx}px,${cy}px)`}}>{children}</div>\n  );\n};\n\nconst Blocks = ({blocks}) =>\n  Object.entries(blocks).map(([key, {x, y, type}]) => (\n    <div\n      key={key}\n      className=\"tile\"\n      style={{\n        transform: `translate(${x * scale}px, ${y * scale}px)`,\n        background: getBackground(type),\n      }}\n    />\n  ));\n\nconst You = ({you, typeIndex}) => {\n  const wombatAngle = Math.atan2(you.dirY, you.dirX) + Math.PI;\n  const wombatFlip =\n    wombatAngle >= 0.5 * Math.PI && wombatAngle <= 1.5 * Math.PI;\n  return (\n    <div\n      className=\"tile\"\n      style={{\n        transform: `\n      translate(${you.x * scale}px,${you.y * scale}px)\n      rotate(${wombatAngle}rad)\n      ${wombatFlip ? 'scaleY(-1)' : ''}`,\n        background: getBackground(typeIndex.w),\n      }}\n    />\n  );\n};\n\nconst Bar = ({value, maxValue, color}) => (\n  <div className=\"bar\">\n    <div style={{background: color, width: (100 * value) / maxValue + '%'}}>\n      {Math.floor(value)}\n    </div>\n  </div>\n);\n\nconst Hud = ({health, maxHealth, poop, maxPoop, jewels}) =>\n  health > 0 ? (\n    <div className=\"hud\">\n      <Bar\n        value={health}\n        maxValue={maxHealth}\n        color={health > 30 ? 'green' : 'red'}\n      />\n      <Bar value={poop} maxValue={maxPoop} color=\"saddleBrown\" />\n      <div className=\"jewelCounter\">\n        {jewels} Jewel{jewels === 1 ? '' : 's'}\n      </div>\n    </div>\n  ) : (\n    <div className=\"youDead\">\n      <h1>you dead</h1>\n      <h2>press R to try again</h2>\n    </div>\n  );\n\nconst Render = ({\n  you,\n  blocks,\n  health,\n  maxHealth,\n  poop,\n  maxPoop,\n  jewels,\n  typeIndex,\n}) => (\n  <>\n    <Viewport you={you}>\n      <Blocks blocks={blocks} />\n      <You you={you} typeIndex={typeIndex} />\n    </Viewport>\n\n    <Hud {...{health, maxHealth, poop, maxPoop, jewels}} />\n  </>\n);\n\nconst GameContainer = () => {\n  const game = useRef();\n  const pressing = useRef({});\n  const [, setCounter] = useState(0); // this is literally only to force rerendering\n\n  useEffect(() => {\n    let loop;\n    load().then((newGame) => {\n      game.current = newGame;\n      loop = () => {\n        game.current.iterate(pressing.current);\n        setCounter((c) => c + 1);\n        requestAnimationFrame(loop);\n      };\n      loop();\n    });\n\n    const keypress = (e) => (pressing.current[e.code] = e.type === 'keydown');\n    window.addEventListener('keydown', keypress);\n    window.addEventListener('keyup', keypress);\n    return () => {\n      window.removeEventListener('keydown', keypress);\n      window.removeEventListener('keyup', keypress);\n      cancelAnimationFrame(loop);\n    };\n  }, []);\n\n  return game.current && <Render {...game.current} />;\n};\n\ncreateRoot(document.querySelector('#root')).render(\n  <StrictMode>\n    <GameContainer />\n  </StrictMode>\n);\n","export const getBackground = (type) =>\n  type?.image ? `no-repeat center/contain url(${type.image})` : type?.color;\n"],"names":["initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","getDatabase","auth","getAuth","dbRef","ref","update","updates","onError","console","log","_update","e","error","message","window","x","loadData","things","Object","Promise","all","map","t","get","child","val","fromEntries","listen","pathStr","onChange","r","onValue","snapshot","off","logIn","email","pwd","signInWithEmailAndPassword","listenUser","onAuthStateChanged","logOut","signOut","Game","youPos","blocks","config","typeIndex","this","frame","you","y","xs","ys","dirX","dirY","jewels","digSpeed","eatSpeed","gravity","health","maxHealth","poop","maxPoop","jumpPower","magmaDelay","moveSpeed","moveDeceleration","isNaN","Number","pressing","iterateYou","iterateMagma","KeyR","location","reload","KeyA","KeyD","KeyW","KeyS","jumping","Math","floor","ceil","key","interact","dx","dy","b","magma","values","filter","type","movement","sort","a","random","isEmpty","move","left","right","block","onIntersect","abs","collectible","healing","max","edible","Space","undefined","eaten","min","makePoop","diggable","dug","load","tileTypes","world","gameConfig","id","tileType","hash","length","JSON","parse","atob","slice","scale","Viewport","children","cx","innerWidth","cy","innerHeight","style","transform","Blocks","entries","className","background","getBackground","You","wombatAngle","atan2","PI","wombatFlip","w","Bar","value","maxValue","color","width","Hud","Render","GameContainer","game","useRef","useState","setCounter","useEffect","loop","then","newGame","current","iterate","c","requestAnimationFrame","keypress","code","addEventListener","removeEventListener","cancelAnimationFrame","createRoot","document","querySelector","render","StrictMode","image"],"sourceRoot":""}