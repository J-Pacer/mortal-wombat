"use strict";(self.webpackChunkmortal_wombat=self.webpackChunkmortal_wombat||[]).push([[602],{602:function(e,n,t){t.r(n);var r=t(791),o=t(250),i=t(885),a=t(184),u=function(e){var n=e.errors,t=e.clearError;return Object.keys(n).length>0&&(0,a.jsx)("div",{className:"errorBanner",children:Object.entries(n).map((function(e){var n=(0,i.Z)(e,2),r=n[0],o=n[1];return(0,a.jsxs)("div",{children:[o," ",(0,a.jsx)("a",{onClick:function(){return t(r)},children:"[x]"})]},r)}))})},c=t(942),l=t(413),s=t(457),f=t(861),d=t(757),p=t.n(d),h=t(63),m=function(e){var n=e.onError,t=(0,r.useState)(""),o=(0,i.Z)(t,2),u=o[0],c=o[1],l=(0,r.useState)(""),s=(0,i.Z)(l,2),d=s[0],m=s[1];return(0,a.jsx)("div",{style:{width:300,margin:"50px auto"},children:(0,a.jsxs)("form",{className:"login",onSubmit:function(){var e=(0,f.Z)(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,(0,h.Ib)(u,d);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),n(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(n){return e.apply(this,arguments)}}(),children:[(0,a.jsx)("input",{type:"email",placeholder:"email",value:u,onChange:function(e){return c(e.target.value)}}),(0,a.jsx)("input",{type:"password",placeholder:"password",value:d,onChange:function(e){return m(e.target.value)}}),(0,a.jsx)("button",{style:{width:"100%"},children:"Log In"})]})})},v=function(e){var n=(0,r.useState)({}),t=(0,i.Z)(n,2),o=t[0],a=t[1];return(0,r.useEffect)((function(){return(0,h.oL)("users",(function(e){return a(function(e){return(0,s.HK)((function(e){return e.email}),Object.values(e))}(e))}),e)}),[]),o},y=t(408),b=15e3,g=(0,s.M8)(),x=function(e){var n=0;for(var t in e)n=Math.max(n,e[t].tstamp);return n},w=function(e){var n=(0,r.useState)({}),t=(0,i.Z)(n,2),o=t[0],a=t[1];return(0,r.useEffect)((function(){return(0,h.oL)("cursors",a,e)}),[]),(0,r.useEffect)((function(){Math.random()<.01&&function(e,n){var t={},r=x(e);for(var o in e)r-e[o].tstamp>b&&(t["cursors/"+o]=null);(0,h.Vx)(t,n)}(o,e)}),[o]),o},j=(0,s.P2)((function(e,n,t,r,o,i,a){return(0,h.Vx)((0,c.Z)({},"cursors/".concat(g),{user:e.email,mouseX:n,mouseY:t,left:r-innerWidth/i/2,top:o-innerHeight/i/2,width:innerWidth/i,height:innerHeight/i,tstamp:(0,y.Bt)()}),a)}),500),C=function(e){var n=e.cursors,t=e.scale,o=e.userIndex,u=x(n);return Object.entries(n).map((function(e){var n,c,l=(0,i.Z)(e,2),s=l[0],f=l[1],d=f.user,p=f.left,h=f.top,m=f.width,v=f.height,y=f.tstamp,x=f.mouseX,w=f.mouseY;if(s===g||u-y>b)return null;var j=1-(u-y)/b;return(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)("div",{className:"cursorView",style:{left:p*t,top:h*t,width:m*t,height:v*t,opacity:j},children:(0,a.jsx)("span",{children:(null===(n=o[d])||void 0===n?void 0:n.name)||d})}),x&&w?(0,a.jsxs)("div",{className:"mouseCursor",style:{left:(x+.5)*t,top:(w+.5)*t,opacity:j},children:[(0,a.jsx)("i",{className:"fa-solid fa-arrow-pointer"}),(0,a.jsx)("span",{children:(null===(c=o[d])||void 0===c?void 0:c.name)||d})]}):null]},s)}))},T=function(e,n,t,r){return{x:Math.floor((e.clientX-innerWidth/2)/n)+t,y:Math.floor((e.clientY-innerHeight/2)/n)+r}},S=function(e){return{background:e.image?"no-repeat center/contain url(".concat(e.image,")"):e.color}},E=function(e){var n=e.world,t=e.tileTypes,o=e.selectedTileTypeId,u=e.onError,f=e.xCoord,d=e.yCoord,p=e.scale,m=e.user,v=e.cursors,y=e.userIndex,b=(0,r.useRef)(),g=(0,r.useMemo)((function(){return(0,s.HK)((function(e){return e.id}),(0,s.aW)(t))}),[t]),x=function(e){var t=T(e,p,f,d),r=t.x,i=t.y;if(e.altKey)return window.open(location.href.replace(/\?.*/,"")+"#"+btoa(JSON.stringify({x:r,y:i})),"_blank"),e.preventDefault(),!1;if(o){var a,l=null===(a=n["".concat(r,"_").concat(i)])||void 0===a?void 0:a.tileType,s=e.shiftKey?"_delete":o;!l&&"_delete"===s||l===s||function(e,n,t,r,o){(0,h.Oz)((0,c.Z)({},"world/".concat(e,"_").concat(n),"_delete"===t?null:{x:e,y:n,tileType:t}),r,o)}(r,i,s,m,u)}},w=(0,r.useCallback)((function(e){var n=T(e,p,f,d),t=n.x,r=n.y;if(o){var i,a=null===(i=b.current)||void 0===i?void 0:i.style;a.left=t*p+"px",a.top=r*p+"px",e.buttons&&x(e)}j(m,t,r,f,d,p,u)}),[p,f,d,o,m]),E=innerWidth/2-f*p,k=innerHeight/2-d*p;return(0,a.jsx)("div",{className:"world",onClick:x,onMouseMove:w,children:(0,a.jsxs)("div",{style:{transform:"translate(".concat(E,"px,").concat(k,"px)")},children:[(0,a.jsx)(C,{cursors:v,scale:p,userIndex:y}),Object.entries(n).filter((function(e){var n=(0,i.Z)(e,2),t=n[0],r=n[1];return!!g[r.tileType]||(console.log("BAD DATA",t,r),!1)})).map((function(e){var n=(0,i.Z)(e,2),t=n[0],r=n[1],o=r.x,u=r.y,c=r.tileType;return(0,a.jsx)("div",{className:"tile",style:(0,l.Z)({left:o*p+"px",top:u*p+"px"},S(g[c]))},t)})),o&&(0,a.jsx)("div",{ref:b,className:"ghost tile",style:S(g[o])})]})})},k=function(e){var n=e.tileTypes,t=e.selectedTileTypeId,r=e.setSelectedTileTypeId,o=e.showTileTypeEditor,i=e.setShowTileTypeEditor;return(0,a.jsx)("div",{className:"toolBar",children:Object.values(n).sort((function(e,n){return e.order-n.order})).map((function(e){return(0,a.jsx)("div",{className:"tileType"+(t===e.id?" selected":""),style:S(e),title:o?"":"Double click to edit tile properties.",onClick:function(){i(!1),r(e.id)},onDoubleClick:function(){return e.id&&!e.id.startsWith("_")&&i(!0)},children:(0,a.jsx)("label",{children:e.label})},e.label)}))})},N={KeyS:"down",KeyA:"left",KeyW:"up",KeyD:"right",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"},Z=function(e){var n,t=e.user,r=e.setScale,o=e.zoomAmt,i=e.userIndex,u=e.children;return(0,a.jsxs)("nav",{children:[t&&(0,a.jsxs)("div",{style:{float:"right"},children:[(0,a.jsx)("button",{onClick:function(){return r((function(e){return Math.round(e*o)}))},children:(0,a.jsx)("i",{className:"fa-solid fa-magnifying-glass-plus"})}),(0,a.jsx)("button",{onClick:function(){return r((function(e){return Math.round(e/o)}))},children:(0,a.jsx)("i",{className:"fa-solid fa-magnifying-glass-minus"})}),"Hi, ",(null===(n=i[t.email])||void 0===n?void 0:n.name)||t.email,"!",(0,a.jsx)("button",{onClick:h.ni,children:"log out"})]}),(0,a.jsx)("b",{children:"Game Editor"}),u]})},I={text:function(e){var n=e.value,t=void 0===n?"":n,r=e.onChange;return(0,a.jsx)("input",{type:"text",value:t,onChange:function(e){return r(e.target.value)}})},number:function(e){var n=e.value,t=void 0===n?"":n,r=e.onChange;return(0,a.jsx)("input",{type:"number",value:t,onChange:function(e){return r(e.target.value)}})},checkbox:function(e){var n=e.value,t=void 0!==n&&n,r=e.onChange;return(0,a.jsx)("input",{type:"checkbox",checked:t,onChange:function(e){return r(e.target.checked)}})}},O=function(e){var n=e.fields,t=e.data,r=e.onChange;return n.map((function(e){var n=e.prop,o=e.label,i=e.type,u=e.info,c=I[i];return(0,a.jsxs)("div",{title:u,children:[(0,a.jsx)("label",{children:o}),(0,a.jsx)(c,{value:null===t||void 0===t?void 0:t[n],onChange:function(e){return r(e,n)}})]},n)}))},H=[{prop:"label",label:"Label",type:"text",info:"The label you see in the tool bar below."},{prop:"image",label:"Image URL",type:"text",info:"The image. uhduhhhh"},{prop:"color",label:"Color",type:"text",info:"The color to use if there is no image"},{prop:"healing",label:"Healing",type:"number",info:"How much does it heal (or hurt) when you eat/touch it (per frame)?"},{prop:"edible",label:"Edible",type:"checkbox",info:"Can you eat it?"},{prop:"diggable",label:"Diggable",type:"checkbox",info:"Can you dig it?"},{prop:"collectible",label:"Collectible",type:"checkbox",info:"Can you collect it?"},{prop:"movable",label:"Movable",type:"checkbox",info:"Can you push it?"},{prop:"order",label:"Order",type:"number",info:"The order it shows up in the toolbar below"}],M=function(e){var n=e.selectedTileTypeId,t=e.tileTypes,r=e.user,o=e.onError,i=(0,s.aW)(t).find((function(e){return e.id===n}));return i&&(0,a.jsx)("div",{className:"tileTypeEditor",children:(0,a.jsx)(O,{fields:H,data:i,onChange:function(e,n){(0,h.Oz)((0,c.Z)({},"tileTypes/".concat(i.key,"/").concat(n),e),r,o)}})})},D=function(e,n){var t=(0,r.useState)(void 0===localStorage[e]?n:function(e,n){try{return JSON.parse(e)}catch(t){return console.error(t),n}}(localStorage[e],n)),o=(0,i.Z)(t,2),a=o[0],u=o[1];return(0,r.useEffect)((function(){localStorage[e]=JSON.stringify(a)}),[a]),[a,u]},A=[{prop:"digSpeed",label:"Wombat Digging Speed",type:"number",info:"How fast much can you dig in one frame?"},{prop:"eatSpeed",label:"Wombat Eating Speed",type:"number",info:"How fast much can you eat in one frame?"},{prop:"gravity",label:"Gravity",type:"number",info:"How strong is gravity?"},{prop:"health",label:"Wombat Starting Health",type:"number",info:"How much health do you start with?"},{prop:"jumpPower",label:"Wombat Jumping Power",type:"number",info:"How much jumping power do you start with?"},{prop:"moveSpeed",label:"Wombat Acceleration",type:"number",info:"How fast can you move?"},{prop:"moveDeceleration",label:"Wombat Deceleration",type:"number",info:"How fast can you slow down?"},{prop:"magmaDelay",label:"Magma Delay",type:"number",info:"Number of frames between magma movements"}],L=function(e){var n=e.onError,t=e.user,o=function(e){var n=(0,r.useState)(),t=(0,i.Z)(n,2),o=t[0],a=t[1];return(0,r.useEffect)((function(){return(0,h.oL)("gameConfig",a,e)}),[]),o}(n);return(0,a.jsx)("div",{className:"gameConfig",children:(0,a.jsx)(O,{fields:A,data:o,onChange:function(e,r){(0,h.Oz)((0,c.Z)({},"gameConfig/".concat(r),e),t,n)}})})},W=(0,s.Ds)((function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];location.hash=n.join("/")}),1e3),K=function(e){var n=e.className,t=e.hide,r=e.label,o=e.children;return(0,a.jsxs)("div",{className:"pane ".concat(n),children:[(0,a.jsxs)("header",{children:[(0,a.jsx)("a",{onClick:t,children:"[x]"}),(0,a.jsx)("strong",{children:r})]}),o]})},B=function(e){var n=e.cursors,t=e.userIndex,r=x(n);return Object.entries(n).filter((function(e){return r-e[1].tstamp<b})).sort((function(e,n){return n[1].tstamp-e[1].tstamp})).map((function(e){var n,r=(0,i.Z)(e,2),o=r[0],u=r[1],c=u.user,l=u.mouseX,s=u.mouseY;return(0,a.jsxs)("div",{style:{margin:5},children:[(null===(n=t[c])||void 0===n?void 0:n.name)||c,l&&s&&(0,a.jsx)("a",{className:"button",style:{margin:"0 10px"},href:"#".concat(l,"/").concat(s,"/32"),children:"go"})]},o)}))},Y=[{key:"gameConfig",label:"Config",icon:"toolbox"},{key:"tileTypeEditor",label:"Tile Type Editor",hideButton:!0},{key:"hereNow",label:"People",icon:"person"},{key:"debug",label:"Debug",icon:"bug"}],X=function(){var e,n=function(){var e=(0,r.useState)({}),n=(0,i.Z)(e,2),t=n[0],o=n[1];return[t,function(e){o((function(n){return(0,l.Z)((0,l.Z)({},n),{},(0,c.Z)({},(0,s.M8)(),e))}))},function(e){return o((function(n){return(0,s.an)(e,n)}))}]}(),t=(0,i.Z)(n,3),o=t[0],f=t[1],d=t[2],p=function(){var e=(0,r.useState)(),n=(0,i.Z)(e,2),t=n[0],o=n[1];return(0,r.useEffect)((function(){return(0,h.G9)(o)}),[]),t}(),y=v(f),b=function(e){var n=(0,r.useState)(),t=(0,i.Z)(n,2),o=t[0],a=t[1];return(0,r.useEffect)((function(){return(0,h.oL)("tileTypes",a,e)}),[]),o}(f),g=function(e){var n=(0,r.useState)({}),t=(0,i.Z)(n,2),o=t[0],a=t[1];return(0,r.useEffect)((function(){return(0,h.oL)("world",a,e)}),[]),o}(f),x=w(f),C=(0,r.useState)(),T=(0,i.Z)(C,2),S=T[0],I=T[1],O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=(0,r.useState)(e),o=(0,i.Z)(t,2),a=o[0],u=o[1],c=(0,r.useState)(n),l=(0,i.Z)(c,2),s=l[0],f=l[1];return(0,r.useEffect)((function(){var e=function(e){if(e.target===document.body){var n=N[e.code];"up"===n&&f((function(e){return e-4})),"down"===n&&f((function(e){return e+4})),"left"===n&&u((function(e){return e-4})),"right"===n&&u((function(e){return e+4}))}};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[]),{xCoord:a,yCoord:s,setXCoord:u,setYCoord:f}}(0,0),H=O.xCoord,A=O.yCoord,X=O.setXCoord,_=O.setYCoord,z=(0,r.useState)(32),P=(0,i.Z)(z,2),J=P[0],G=P[1],U=(e=Y,Object.fromEntries(e.map((function(e){var n=e.key,t=e.label,r=e.icon,o=e.hideButton,u=D("show"+t,!1),c=(0,i.Z)(u,2),l=c[0],s=c[1];return[n,{key:n,label:t,button:!o&&(0,a.jsxs)("button",{className:l?"active":"",onClick:function(){return s((function(e){return!e}))},children:[(0,a.jsx)("i",{className:"fa-solid fa-".concat(r)})," ",t]},n),show:l,setShow:s}]}))));return(0,r.useEffect)((function(){document.documentElement.style.setProperty("--scale",J+"px")}),[J]),function(e){var n=e.xCoord,t=e.yCoord,o=e.scale,a=e.setXCoord,u=e.setYCoord,c=e.setScale;(0,r.useEffect)((function(){return W(n,t,o),W.cancel}),[o,n,t]),(0,r.useEffect)((function(){var e=function(){var e=location.hash.slice(1).split("/").map(Number);if(3===e.length&&e.every((function(e){return!isNaN(e)}))){var n=(0,i.Z)(e,3),t=n[0],r=n[1],o=n[2];a(t),u(r),c(o)}};return e(),window.addEventListener("hashchange",e),function(){window.removeEventListener("hashchange",e)}}),[])}({xCoord:H,yCoord:A,scale:J,setXCoord:X,setYCoord:_,setScale:G}),(0,r.useEffect)((function(){p&&j(p,null,null,H,A,J,f)}),[p,H,A,J]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z,{user:p,scale:J,setScale:G,zoomAmt:1.25,userIndex:y,children:Object.values(U).map((function(e){return e.button}))}),(0,a.jsx)(u,{errors:o,clearError:d}),p?(0,a.jsxs)("div",{className:"appContainer",children:[U.debug.show&&(0,a.jsx)(K,{label:U.debug.label,className:"debugContainer",hide:function(){return U.debug.setShow(!1)},children:(0,a.jsx)("textarea",{readOnly:!0,value:JSON.stringify({xCoord:H,yCoord:A,scale:J,selectedTileTypeId:S,errors:o,user:p,cursors:x},null,2)})}),S&&b&&U.tileTypeEditor.show&&Object.values(b).some((function(e){return e.id===S}))&&(0,a.jsx)(K,{label:U.tileTypeEditor.label,className:U.tileTypeEditor.key+"Container",hide:function(){return U.tileTypeEditor.setShow(!1)},children:(0,a.jsx)(M,{selectedTileTypeId:S,tileTypes:b,user:p,onError:f})}),U.gameConfig.show&&(0,a.jsx)(K,{label:"Game Config",className:"gameConfigContainer",hide:function(){return U.gameConfig.setShow(!1)},children:(0,a.jsx)(L,{onError:f,user:p})}),U.hereNow.show&&(0,a.jsx)(K,{label:"Using the Editor Right Now",className:"hereNowContainer",hide:function(){return U.hereNow.setShow(!1)},children:(0,a.jsx)(B,{cursors:x,userIndex:y})}),b&&(0,a.jsx)("div",{className:"toolContainer",children:(0,a.jsx)(k,{tileTypes:b,selectedTileTypeId:S,setSelectedTileTypeId:I,showTileTypeEditor:U.tileTypeEditor.show,setShowTileTypeEditor:U.tileTypeEditor.setShow})}),g&&b&&(0,a.jsx)("div",{className:"worldEditorContainer",children:(0,a.jsx)(E,{world:g,selectedTileTypeId:S,tileTypes:b,onError:f,xCoord:H,yCoord:A,scale:J,user:p,cursors:x,userIndex:y})})]}):(0,a.jsx)(m,{onError:f})]})};document.title="Mortal Wombat Editor",(0,o.s)(document.querySelector("#root")).render((0,a.jsx)(r.StrictMode,{children:(0,a.jsx)(X,{})}))},63:function(e,n,t){t.d(n,{G9:function(){return x},Ib:function(){return g},Oz:function(){return v},Vx:function(){return m},mu:function(){return y},ni:function(){return w},oL:function(){return b}});var r=t(861),o=t(942),i=t(413),a=t(757),u=t.n(a),c=t(426),l=t(408),s=t(162),f=t(457);(0,c.ZF)({apiKey:"AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I",authDomain:"mortal-wombat-8c76a.firebaseapp.com",projectId:"mortal-wombat-8c76a",storageBucket:"mortal-wombat-8c76a.appspot.com",messagingSenderId:"929181149015",appId:"1:929181149015:web:33a7f450bcdbb06ae64012",measurementId:"G-JL6HCMYYBS"});var d=(0,l.N8)(),p=(0,s.v0)(),h=(0,l.iH)(d),m=function(e,n){try{return console.log("updates",e),(0,l.Vx)(h,e)}catch(t){console.error(t),n(t.message)}},v=function(e,n,t){return m((0,i.Z)((0,i.Z)({},e),{},(0,o.Z)({},"history/".concat((0,f.M8)()),{update:JSON.stringify(e),user:n.email,tstamp:(0,l.Bt)()})),t)},y=function(){var e=(0,r.Z)(u().mark((function e(n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Object,e.next=3,Promise.all(n.map(function(){var e=(0,r.Z)(u().mark((function e(n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=n,e.next=3,(0,l.U2)((0,l.iU)(h,n));case 3:return e.t1=e.sent.val(),e.abrupt("return",[e.t0,e.t1]);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.fromEntries.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),b=function(e,n,t){try{var r=(0,l.iH)(d,e);return(0,l.jM)(r,(function(e){return n(e.val())})),function(){return(0,l.S1)(r)}}catch(o){console.error(o),t(o.message)}},g=function(e,n){return(0,s.e5)(p,e,n)},x=function(e){return(0,s.Aj)(p,e)},w=function(){return(0,s.w7)(p)}},457:function(e,n,t){t.d(n,{Ds:function(){return f},HK:function(){return l},M8:function(){return c},P2:function(){return d},aW:function(){return s},an:function(){return u}});var r=t(982),o=t(885),i=t(762),a=t(413),u=function(e,n){var t=(0,a.Z)({},n);return delete t[e],t},c=function(){return Date.now().toString(36)+":"+Math.random().toString(36).slice(2)},l=function(e,n){var t,r={},o=(0,i.Z)(n);try{for(o.s();!(t=o.n()).done;){var a=t.value;r[e(a)]=a}}catch(u){o.e(u)}finally{o.f()}return r},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.entries(e).map((function(e){var n=(0,o.Z)(e,2),t=n[0],r=n[1];return(0,a.Z)({key:t},r)}))},f=function(e,n){var t,r=function(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];clearTimeout(t),t=setTimeout((function(){return e.apply(void 0,o)}),n)};return r.cancel=function(){return clearTimeout(t)},r},d=function(e,n){var t,o,i=!1,a=function a(){for(var u=arguments.length,c=new Array(u),l=0;l<u;l++)c[l]=arguments[l];i?o=c:(i=!0,t=setTimeout((function(){e.apply(void 0,c),i=!1,o&&a.apply(void 0,(0,r.Z)(o)),o=void 0}),n))};return a.cancel=function(){return clearTimeout(t)},a}}}]);
//# sourceMappingURL=602.c41ac84f.chunk.js.map