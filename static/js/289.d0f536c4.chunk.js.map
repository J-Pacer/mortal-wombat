{"version":3,"file":"static/js/289.d0f536c4.chunk.js","mappings":"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","sources":["firebase.js","game/CanvasRenderer.js","game/Game.js","game/main.js"],"sourcesContent":["import {initializeApp} from 'firebase/app';\nimport {\n  ref,\n  getDatabase,\n  update as _update,\n  onValue,\n  off,\n  get,\n  child,\n} from 'firebase/database';\nimport {\n  getAuth,\n  signInWithEmailAndPassword,\n  onAuthStateChanged,\n  signOut,\n} from 'firebase/auth';\n\ninitializeApp({\n  apiKey: 'AIzaSyBEserPzSUos4MT3XRO8NKAO2oVk1-LS-I',\n  authDomain: 'mortal-wombat-8c76a.firebaseapp.com',\n  projectId: 'mortal-wombat-8c76a',\n  storageBucket: 'mortal-wombat-8c76a.appspot.com',\n  messagingSenderId: '929181149015',\n  appId: '1:929181149015:web:33a7f450bcdbb06ae64012',\n  measurementId: 'G-JL6HCMYYBS',\n});\n\n/*\n\nData:\nhttps://console.firebase.google.com/project/mortal-wombat-8c76a/database/mortal-wombat-8c76a-default-rtdb/data\nData Docs: https://firebase.google.com/docs/database/web/read-and-write?hl=en&authuser=0\n\nUsers:\nhttps://console.firebase.google.com/project/mortal-wombat-8c76a/authentication/users\nUser Docs: https://firebase.google.com/docs/auth/web/manage-users\n\n\n*/\n\nconst db = getDatabase();\nconst auth = getAuth();\nconst dbRef = ref(db);\n\n// {path1: val1, path2: val2}\nexport const update = (updates, onError) => {\n  try {\n    console.log('updates', updates);\n    return _update(dbRef, updates);\n  } catch (e) {\n    console.error(e);\n    onError(e.message);\n  }\n};\n\nwindow._update = async (x) => console.log(await _update(dbRef, x));\n\n// export const updateWithHistory = (data, user, onError) =>\n//   update(\n//     {\n//       ...data,\n//       [`history/${guid()}`]: {\n//         update: JSON.stringify(data),\n//         user: user.email,\n//         tstamp: serverTimestamp(),\n//       },\n//     },\n//     onError\n//   );\n\nexport const loadData = async (things) =>\n  Object.fromEntries(\n    await Promise.all(\n      things.map(async (t) => [t, (await get(child(dbRef, t))).val()])\n    )\n  );\n\nexport const listen = (pathStr, onChange, onError) => {\n  try {\n    const r = ref(db, pathStr);\n    onValue(r, (snapshot) => onChange(snapshot.val()));\n    return () => off(r);\n  } catch (e) {\n    console.error(e);\n    onError(e.message);\n  }\n};\n\n// export const createUser = async (email, pwd) => {\n//   try {\n//     const result = await createUserWithEmailAndPassword(auth, email, pwd);\n//     return result.user;\n//   } catch (e) {\n//     console.error(e);\n//     return e.message;\n//   }\n// };\n\nexport const logIn = (email, pwd) =>\n  signInWithEmailAndPassword(auth, email, pwd);\n\nexport const listenUser = (onChange) => onAuthStateChanged(auth, onChange);\n\nexport const logOut = () => signOut(auth);\n","const SCALE = 32;\n\nconst shadowText = (ctx, text, x, y, color, offset) => {\n  ctx.fillStyle = 'black';\n  ctx.fillText(text, x + offset, y + offset);\n  ctx.fillStyle = color;\n  ctx.fillText(text, x, y);\n};\n\nconst bar = (ctx, value, maxValue, color, x, y, width, height) => {\n  ctx.fillStyle = color;\n  ctx.fillRect(x, y, (value / maxValue) * width, height);\n  ctx.strokeStyle = 'white';\n  ctx.strokeRect(x, y, width, height);\n  ctx.fillStyle = 'white';\n  ctx.font = '18px sans-serif';\n  ctx.textAlign = 'left';\n  ctx.textBaseline = 'top';\n  ctx.fillText(Math.floor(value), x + 2, y + 1);\n};\n\nexport class CanvasRenderer {\n  constructor(canvas) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d', {antialias: false, depth: false});\n    this.resize();\n    window.addEventListener('resize', () => this.resize());\n  }\n  resize() {\n    const {canvas} = this;\n    this.width = canvas.width = innerWidth;\n    this.height = canvas.height = innerHeight;\n  }\n  render({you, health, maxHealth, poop, maxPoop, blocks}) {\n    const {ctx, width, height} = this;\n\n    ctx.clearRect(0, 0, width, height);\n    ctx.save();\n    ctx.translate(\n      width / 2 - you.x * SCALE - SCALE / 2,\n      height / 2 - you.y * SCALE - SCALE / 2\n    );\n\n    for (const {x, y, type} of Object.values(blocks)) {\n      ctx.fillStyle = type.color;\n      ctx.fillRect(x * SCALE, y * SCALE, SCALE, SCALE);\n    }\n\n    ctx.fillStyle = 'red';\n    ctx.fillRect(you.x * SCALE, you.y * SCALE, SCALE, SCALE);\n    const angle = Math.atan2(you.dirY, you.dirX);\n    ctx.strokeStyle = 'black';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo((you.x + 0.5) * SCALE, (you.y + 0.5) * SCALE);\n    ctx.lineTo(\n      (you.x + 0.5) * SCALE + (Math.cos(angle) * SCALE) / 2,\n      (you.y + 0.5) * SCALE + (Math.sin(angle) * SCALE) / 2\n    );\n    ctx.stroke();\n\n    ctx.restore();\n\n    // HUD\n    if (health > 0) {\n      bar(\n        ctx,\n        health,\n        maxHealth,\n        health > 30 ? 'green' : 'red',\n        10,\n        10,\n        500,\n        20\n      );\n      bar(ctx, poop, maxPoop, 'brown', 10, 40, 500, 20);\n    } else {\n      ctx.textBaseline = 'middle';\n      ctx.textAlign = 'center';\n      ctx.font = '120px sans-serif';\n      shadowText(ctx, 'you dead', innerWidth / 2, innerHeight / 2, 'red', 5);\n      ctx.font = '32px sans-serif';\n      shadowText(\n        ctx,\n        'press R to try again',\n        innerWidth / 2,\n        innerHeight / 2 + 60,\n        '#AFF',\n        3\n      );\n    }\n  }\n}\n","const onIntersect = (game, you, block, pressing) => {\n  if (block.type.collectible) {\n    you.jewels++;\n    return true;\n  }\n\n  if (block.type.healing < 0) {\n    game.health = Math.max(0, game.health + Number(block.type.healing));\n  }\n\n  if (block.type.edible && pressing.Space) {\n    if (block.eaten === undefined) block.eaten = 1;\n    block.eaten -= game.eatSpeed;\n    game.health = Math.min(\n      game.maxHealth,\n      game.health + block.type.healing * game.eatSpeed\n    );\n    game.poop = Math.min(\n      game.maxPoop,\n      game.poop + block.type.makePoop * game.eatSpeed\n    );\n    if (block.eaten <= 0) return true;\n  }\n\n  if (block.type.diggable && pressing.Space) {\n    if (block.dug === undefined) block.dug = 1;\n    block.dug -= game.digSpeed;\n    if (block.dug <= 0) return true;\n  }\n};\n\n// if returns true, then delete block\nconst interact = (game, you, block, pressing) => {\n  if (onIntersect(game, you, block, pressing)) return true;\n  const dx = you.x - block.x;\n  const dy = you.y - block.y;\n  if (Math.abs(dx) > Math.abs(dy)) {\n    you.x = block.x + (you.x < block.x ? -1 : 1);\n    you.xs = 0;\n  } else {\n    if (you.y < block.y) you.jumping = false;\n    you.y = block.y + (you.y < block.y ? -1 : 1);\n    you.ys = 0;\n  }\n};\n\nexport class Game {\n  constructor(youPos, blocks, config) {\n    this.blocks = blocks;\n    this.frame = 0;\n    this.you = {\n      x: 0,\n      y: 0,\n      xs: 0,\n      ys: 0,\n      dirX: 1,\n      dirY: 0,\n      jewels: 0,\n      ...youPos,\n    };\n\n    // these can all be overridden by config\n    this.digSpeed = 0.05;\n    this.eatSpeed = 0.05;\n    this.gravity = 0.005;\n    this.health = 100;\n    this.maxHealth = 100; // TODO\n    this.poop = 0; // TODO\n    this.maxPoop = 10; // TODO\n    this.jumpPower = 0.11;\n    this.magmaDelay = 30;\n    this.moveSpeed = 0.015;\n    this.moveDeceleration = 0.3;\n\n    for (const x in config) {\n      if (!isNaN(config[x])) this[x] = Number(config[x]); // because editing them turns them into strings, yayyyy\n    }\n  }\n  iterate(pressing) {\n    this.iterateYou(pressing);\n    if (this.frame % this.magmaDelay === 0) this.iterateMagma();\n    this.frame++;\n  }\n  iterateYou(pressing) {\n    const {you, blocks, gravity} = this;\n\n    if (this.health <= 0) {\n      if (pressing.KeyR) location.reload();\n      return;\n    }\n\n    if (pressing.KeyA || pressing.KeyD || pressing.KeyW || pressing.KeyS) {\n      you.dirX = 0;\n      you.dirY = 0;\n    }\n    if (pressing.KeyA) {\n      you.xs -= this.moveSpeed;\n      you.dirX--;\n    }\n    if (pressing.KeyD) {\n      you.xs += this.moveSpeed;\n      you.dirX++;\n    }\n    if (pressing.KeyW) {\n      if (!you.jumping && !you.ys) {\n        you.ys -= this.jumpPower;\n        you.jumping = true;\n      }\n      you.dirY--;\n    }\n    if (pressing.KeyS) {\n      you.dirY++;\n    }\n    you.x += you.xs;\n    you.xs *= 1 - this.moveDeceleration;\n    you.ys += gravity;\n    you.y += you.ys;\n\n    for (const key of [\n      `${Math.floor(you.x)}_${Math.floor(you.y)}`,\n      `${Math.ceil(you.x)}_${Math.floor(you.y)}`,\n      `${Math.floor(you.x)}_${Math.ceil(you.y)}`,\n      `${Math.ceil(you.x)}_${Math.ceil(you.y)}`,\n    ]) {\n      if (blocks[key]) {\n        const shouldDelete = interact(this, you, blocks[key], pressing);\n        if (shouldDelete) delete blocks[key];\n      }\n    }\n  }\n  isEmpty(x, y) {\n    return !this.blocks[`${x}_${y}`];\n  }\n  move(x, y, dx, dy) {\n    const key = `${x}_${y}`;\n    const b = this.blocks[key];\n    delete this.blocks[key];\n    b.x += dx;\n    b.y += dy;\n    this.blocks[`${b.x}_${b.y}`] = b;\n  }\n  iterateMagma() {\n    const magma = Object.values(this.blocks)\n      .filter((b) => b.type.movement === 'liquid')\n      .sort((a, b) => (a.y === b.y ? Math.random() - 0.5 : a.y - b.y));\n\n    for (const b of magma) {\n      if (this.isEmpty(b.x, b.y + 1)) {\n        this.move(b.x, b.y, 0, 1);\n      } else {\n        const left = this.isEmpty(b.x - 1, b.y);\n        const right = this.isEmpty(b.x + 1, b.y);\n        if (left && right) {\n          this.move(b.x, b.y, Math.random() < 0.5 ? 1 : -1, 0);\n        } else if (left) {\n          this.move(b.x, b.y, -1, 0);\n        } else if (right) {\n          this.move(b.x, b.y, 1, 0);\n        }\n      }\n    }\n  }\n}\n","import {loadData} from '../firebase.js';\nimport {CanvasRenderer} from './CanvasRenderer.js';\nimport {Game} from './Game.js';\n\nconst init = async () => {\n  const {tileTypes, world, gameConfig} = await loadData([\n    'tileTypes',\n    'world',\n    'gameConfig',\n  ]);\n\n  const typeIndex = {};\n  let you;\n  for (const type of Object.values(tileTypes)) {\n    typeIndex[type.id] = type;\n  }\n  for (const key in world) {\n    const {x, y, tileType} = world[key];\n    if (tileType === 'w') {\n      you = {x, y};\n      delete world[key];\n    } else {\n      world[key] = {x, y, type: typeIndex[tileType]};\n    }\n  }\n\n  if (location.hash.length > 1) {\n    try {\n      you = JSON.parse(atob(location.hash.slice(1)));\n    } catch (e) {\n      console.log('bad hash', e);\n    }\n  }\n\n  console.log(gameConfig);\n  const game = new Game(you, world, gameConfig);\n\n  const canvas = document.createElement('canvas');\n  const renderer = new CanvasRenderer(canvas);\n  document.body.append(canvas);\n\n  document.body.style.background = 'black';\n  document.body.style.margin = 0;\n  document.body.style.overflow = 'hidden';\n\n  const pressing = {};\n\n  const loop = () => {\n    game.iterate(pressing);\n    renderer.render(game);\n    requestAnimationFrame(loop);\n  };\n  loop();\n\n  const keypress = (e) => (pressing[e.code] = e.type === 'keydown');\n  window.addEventListener('keydown', keypress);\n  window.addEventListener('keyup', keypress);\n};\n\ninit();\n"],"names":["initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","getDatabase","auth","getAuth","dbRef","ref","update","updates","onError","console","log","_update","e","error","message","window","x","loadData","things","Object","Promise","all","map","t","get","child","val","fromEntries","listen","pathStr","onChange","r","onValue","snapshot","off","logIn","email","pwd","signInWithEmailAndPassword","listenUser","onAuthStateChanged","logOut","signOut","SCALE","shadowText","ctx","text","y","color","offset","fillStyle","fillText","bar","value","maxValue","width","height","fillRect","strokeStyle","strokeRect","font","textAlign","textBaseline","Math","floor","CanvasRenderer","canvas","this","getContext","antialias","depth","resize","addEventListener","innerWidth","innerHeight","you","health","maxHealth","poop","maxPoop","blocks","clearRect","save","translate","values","type","angle","atan2","dirY","dirX","lineWidth","beginPath","moveTo","lineTo","cos","sin","stroke","restore","interact","game","block","pressing","collectible","jewels","healing","max","Number","edible","Space","undefined","eaten","eatSpeed","min","makePoop","diggable","dug","digSpeed","onIntersect","dx","dy","abs","xs","jumping","ys","Game","youPos","config","frame","gravity","jumpPower","magmaDelay","moveSpeed","moveDeceleration","isNaN","iterateYou","iterateMagma","KeyR","location","reload","KeyA","KeyD","KeyW","KeyS","ceil","key","b","magma","filter","movement","sort","a","random","isEmpty","move","left","right","init","tileTypes","world","gameConfig","typeIndex","id","tileType","hash","length","JSON","parse","atob","slice","document","createElement","renderer","body","append","style","background","margin","overflow","loop","iterate","render","requestAnimationFrame","keypress","code"],"sourceRoot":""}